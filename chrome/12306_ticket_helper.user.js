/*!
 *		12306 订票助手 for Chrome/Firefox/Liebao/Maxthon
 *				BY 木鱼(iFish) fishcn@foxmail.com
 *					官方网站 http://www.fishlee.net/
 *
 *		感谢您的使用，希望能帮助到您买票。
 *		保留所有版权，欢迎学习探讨，但禁止复制部分或任意部分代码、重新包装或改写后分发且不注明原作者或出处。
 *		直接复制代码到自己的东西中发布还不注明来源的同学们请自重。因为使用开源的东西乃们也没有继续开源，所以我已经不公开原始的源代码了。
 *
 *		助人者天助之，黄牛倒票者退散！！！！
 */
function compressFunc(){return!1}function initUIDisplay(){injectStyle()}function injectStyle(){var n=document.createElement("style");n.id="12306_ticket_helper";n.type="text/css";n.textContent=".titlebar{font-weight:bold;font-family:微软雅黑,'Microsoft YaHei';} input:focus,select:focus{outline:0;box-shadow:0 0 10px royalblue;transition:all linear 0.2s;}input, select{font-family:consolas, verdana, arial;}.fish_running, .fish_clock, .fish_error, .fish_ok {line-height:20px;text-indent:18px;background-repeat:no-repeat;background-position:2px 50%;font-size:12px;}.fish_running{background-image:url(data:image/gif;base64,R0lGODlhEAAQALMPAHp6evf394qKiry8vJOTk83NzYKCgubm5t7e3qysrMXFxe7u7pubm7S0tKOjo////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCAAPACwAAAAAEAAQAAAETPDJSau9NRDAgWxDYGmdZADCkQnlU7CCOA3oNgXsQG2FRhUAAoWDIU6MGeSDR0m4ghRa7JjIUXCogqQzpRxYhi2HILsOGuJxGcNuTyIAIfkECQgADwAsAAAAABAAEAAABGLwSXmMmjhLAQjSWDAYQHmAz8GVQPIESxZwggIYS0AIATYAvAdh8OIQJwRAQbJkdjAlUCA6KfU0VEmyGWgWnpNfcEAoAo6SmWtBUtCuk9gjwQKeQAeWYQAHIZICKBoKBncTEQAh+QQJCAAPACwAAAAAEAAQAAAEWvDJORejGCtQsgwDAQAGGWSHMK7jgAWq0CGj0VEDIJxPnvAU0a13eAQKrsnI81gqAZ6AUzIonA7JRwFAyAQSgCQsjCmUAIhjDEhlrQTFV+lMGLApWwUzw1jsIwAh+QQJCAAPACwAAAAAEAAQAAAETvDJSau9L4QaBgEAMWgEQh0CqALCZ0pBKhRSkYLvM7Ab/OGThoE2+QExyAdiuexhVglKwdCgqKKTGGBgBc00Np7VcVsJDpVo5ydyJt/wCAAh+QQJCAAPACwAAAAAEAAQAAAEWvDJSau9OAwCABnBtQhdCQjHlQhFWJBCOKWPLAXk8KQIkCwWBcAgMDw4Q5CkgOwohCVCYTIwdAgPolVhWSQAiN1jcLLVQrQbrBV4EcySA8l0Alo0yA8cw+9TIgAh+QQFCAAPACwAAAAAEAAQAAAEWvDJSau9WA4AyAhWMChPwXHCQRUGYARgKQBCzJxAQgXzIC2KFkc1MREoHMTAhwQ0Y5oBgkMhAAqUw8mgWGho0EcCx5DwaAUQrGXATg6zE7bwCQ2sAGZmz7dEAAA7); color: green;}.fish_clock{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAG/SURBVHjapJM/S8NQFMVvpaVfoEKojWL9U3DLIqjoooJDu/sFmnQoiIujQz+Aix3a1FUQXIR2UFA6+WeRUhBprERroGTopg6lSeo7iY1pq4sNHPpy3+8c7n0v9XW7XRrl8SFAlmVvbYFpmynOJHzXKkwlphOmxx4oiiL5sbAsi1KpFOVyuWQwGMzEYjEuGo0Sx3E2qOu6oKqqoChKst1u7zO2wNifDrLZLNbJUCgkLy2vEM/zv7araRrd3lxTq9US2WshnU7TGDZM01zwBwKZxaVlCkd4MtmxQDXlyVbvHXtgwMIDrx3Q6XS2Z2bnufDEJJkWuWIt2/LWwICFxw0wDCM+PTPXB0K4IGiwDhYeeP3fHQjjXIQMq3/mev3J/l0fqIOFxxtAxi+fg/rsBOztSE7QVpwpQT2PN6Dy1mgIYX7KNZcvipQ5yA+Fosum1rA93jMo1R6q7oxX50Va20wMzd4TWHi8t3BSvb/T1bpz4qsbf5vBgIXHDWB3+vj58b5fPj9jc9fcex8U9sCAhcc7Au1mDgtN7VU8Oz7SL0un9PbyTBYzQVijhj0wYOFxP2VJkv71Z8rn807AKM+XAAMArp1CsEFrDIIAAAAASUVORK5CYII=); color: blue;}.fish_error{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAJFSURBVHjapJO/T1pRFMe/Dx7ypEXri4lUGUhsHF40hODSpQ61cTH+2HSoZaF1dHSxpU7+Ca04NE7dyuBiapcuLFokTdD4A01awNdBSkAf8ut5zhUoxq3e5OS+nPv5nnvuyfdJpmniPksSBd68aM1pFDMU4xS+ei5GsUHxmSLRJD9+hcx7rVqFZWwMtc3NIGy2Zam31yX19ABdXTdgNuszdd1nptNBlMtviQ0TC0ujg1LgGWNByelctQ4M4G8qhfN4HLmDA6HvpJzq9eJRXx+qlDPz+deUDrd9+i6KoFouazVg2erx4M/uLn5FItGLk5NX/qUliYO+I2o2C4vLBWaYZQ1rRYFyqTQDVXXl02mcb29HbXb7S+/CwjqKRSAaDXlHRqYwOoqdxUUww6zQNApUSqVxuaMDF8kk2hTlgxYIHMMwaHSxEB2/a4g7u7sjzDDLmn8dXF35ZJsNVWrzycTEOtxuYH//lpjWezqbZoZZ1rQ+AXyj3eEQO7a27oj9s7OhVkZoWjqIFXUdD1QVub29L3fEk5MhXF7y2RwzzLKmdQYb+UwGiqLwO6duiVdWxM2GrvfTfOaZYZY1TScmvE7NKsvf3B6PyzE8jB9ra6DJR2TTnBYXSNIcbfN021Mjl8Pv09OzaqXyXIvnE6LAT00RRlLa21cfk1kesgNpULBab5xITiUHokADzJDJioYhjDSUKNafUKlgaHAwXCCHJQ8Pz1JHRyhQm2RhEfzNOT5jhlnWNJ+w0y/918/kPzbrf+M91rUAAwCuQDz94e2kLwAAAABJRU5ErkJggg==); color: blue;}.fish_ok{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAHsSURBVHjapFNBSBtBFH2xgoqmKipEC6XkYqhUWXOxUAQhpyJ4Wgi0l0rNsdBbL/WgF2/eV8hNSBF68uhFkOrFhCAGS8mWgmYjG9lCKVGTuP1vsrvuIac68HZm/n/vz5/9fyKu6+IhI8IA5k4kbHsuSAsWBZpnKwh2BTlBySfGdTmcAX7kOJc5r5hfhyw7/86t21/EVVbgmjb6yPG4SqsyONtWGaz0Dk8aYzMf0R+b65ju3+oR7OImrp3vGdluJd646KKj1ZK0H0XXRqfeo390Emg6HUEfOeQqjQwVoNFAOvpkPjYw8kw2NRgfFtQchm8jh1xqggDNJhYHY3Jy41IhmXodrDvZyKWG2m4vA23gcR9wa6m7Jue1YO2PsI1casIB5GPBWM8ilZLyvFzu+BPNwyz29oDM5+W2JhSg8NsqaRSTMHycxfg4MDHRJlUqgCWHO/IvyRGu0gQB5D671Z+mlpiZFXEejjSInrw/OS4wjiWwNFx8ehZnRVNpwlXI/SrXqvbFOfS3TxWRAtNpwxfTRw651AQZSE1Lrfrd6mmhZky96IGejuJgX5rL9HpbrvBKbHbFxunJDa6F67e0X0YsLWHr6uouc/StXi3m/yCRkNTjbXBNG33kkEtN8Jh2Pv3fY9I3vLfwkPFPgAEApRUigcIVl3AAAAAASUVORK5CYII=); color: purple;}.outerbox{font-family:'Microsoft Yahei','Apple LiGothic Medium',Arial,Helvetica,Sans-serif;color:#4c4c4c;width:100%;margin: 10px auto;}.box{border:1px solid #c6c6c6;}.box .title{padding:5px;line-height:23px;color:#fff;background:-webkit-linear-gradient(#707070,#2c2c2c 90%);background:-moz-linear-gradient(#707070,#2c2c2c 90%);background-color:#707070; position: relative;}.box .title a{color:#fff;}.box .time-comp{color:#fff;position:absolute;margin:2px;right:2px;top:2px;padding:1px 12px;border-radius:12px;text-shadow:0px 1px 2px rgba(0,0,0,0.6);box-shadow:0px 1px 1px rgba(255,255,255,0.2),inset 0px 0px 8px rgba(0,0,0,0.8);}.box .content{padding:5px;background-color:#fff}.box table{border-collapse:collapse;width:98%}.box table td{padding:5px;}.box table .tfooter{text-align:center;height:24px;background:-webkit-linear-gradient(#ffffff,#fafafa 90%);background:-moz-linear-gradient(#ffffff,#fafafa 90%);color:#707070;text-shadow:1px 1px 1px #fff,2px 2px 1px rgba(0,0,0,0.2);}.box table .tfooter a{color:#707070;}.box input[type=button],.fish_button,.fish_button_highlight{font-size:12px;font-family:'Microsoft Yahei','Apple LiGothic Medium',Arial,Helvetica,Sans-serif;padding:1px 6px;letter-spacing:1px;border-radius:3px;cursor:pointer;}.box .name,.box .caption,.box .caption td{font-weight:bold;-webkit-transition:all linear 0.2s;-moz-transition:all linear 0.2s;background:-webkit-linear-gradient(#fafafa,#f0f0f0 90%);background:-moz-linear-gradient(#fafafa,#f0f0f0 90%);background-color:#fafafa;}.box .lineButton{margin:4px 6px 4px 2px;}.lineButton{font-family:'Microsoft Yahei','Apple LiGothic Medium',Arial,Helvetica,Sans-serif;line-height:16px;margin-right:6px;padding:2px 4px;color:#4c4c4c;backround:#f5f5f5;background:-webkit-linear-gradient(#fff,#f0f0f0);background:-moz-linear-gradient(#fff,#f0f0f0);border:1px solid #c8c8c8;border-radius:3px;box-shadow:inset 0 1px 3px rgba(255,255,255,0.2),0 0 3px rgba(0,0,0,0.2);text-shadow:.0em .1em .1em rgba(255,255,255,0.8);-webkit-transition:all linear 0.2s;-moz-transition:all linear 0.2s;cursor:pointer;}.lineButton:hover{background:#f0f0f0;text-shadow:.0em .1em .1em #fff;-webkit-transition:all linear 0.1s;-moz-transition:all linear 0.1s;}.lineButton:active{background:#f2f2f2;background:-webkit-gradient(linear,left bottom,left top,color-stop(0%,#f2f2f2),color-stop(90%,#f2f2f2));background:-moz-linear-gradient(center bottom,#f2f2f2 0%,#f2f2f2 100%);box-shadow:inset 0px 1px 3px #cccccc,0px 0px 0px #0968bb;border-color:#d6d6d6;border-top-color:#d0d0d0;border-left-color:#d0d0d0;border-right-color:#e2e2e2;border-bottom-color:#e2e2e2;}.fishTab{border:5px solid #C4C9DF;font-size:12px;font-family:'Microsoft Yahei','Apple LiGothic Medium',Arial,Helvetica,Sans-serif;}.fishTab .innerTab{border-width:1px;border-style:solid;border-color:#7381AC;background-color:#fff}.fishTab .tabNav{font-weight:bold;color:#F5F1F8;background-color:#777FA7;line-height:25px;overflow:hidden;margin:0px;padding:0px}.fishTab .tabNav li{float:left;list-style:none;cursor:pointer;padding-left:20px;padding-right:20px}.fishTab .tabNav li:hover{background-color:#B1BBE2}.fishTab .tabNav li.current{background-color:#fff;color:#000}.fishTab .tabContent{padding:5px;display:none}.fishTab .tabContent p{margin:10px 0px 10px 0px}.fishTab div.current{display:block}.fishTab div.control{text-align:center;line-height:25px;background-color:#EAECF4}.fishTab input[type=button]{padding:2px 5px;margin:4px;}.hide{display:none}.fish_area {font-weight:bold;background: -webkit-linear-gradient(#cfcfcf 0%, #bfbfbf 50%, #b5b5b5 50%, #cacaca 100%); color: #555; text-shadow: 1px 1px 2px #ddd;}.fish_area td {font-weight:bold; text-align:center;}.fish_sep td{border-top:1px solid #d0d0d0;}.fish_button{color:#fff;line-height:normal;margin:0 5px;background:#0f7edb;background:-webkit-linear-gradient(#0c96f8,#1960b7);background:-moz-linear-gradient(#0c96f8,#1960b7);border:1px solid #186fb7;box-shadow:inset 0 1px 3px rgba(255,255,255,0.2),0 0 3px rgba(0,0,0,0.3);text-shadow:.0em .1em .1em rgba(50,50,50,0.8);-webkit-transition:all linear 0.2s;-moz-transition:all linear 0.2s;}.fish_button:hover{background:#099bff;background:-webkit-gradient(linear,left bottom,left top,color-stop(0%,#077ccc),color-stop(90%,#0abaff));background:-moz-linear-gradient(center bottom,#077ccc 0%,#0abaff 100%);border-color:#088be5;-webkit-transition:all linear 0.1s;-moz-transition:all linear 0.1s;}.fish_button:active{background:#0885e7;background:-webkit-gradient(linear,left bottom,left top,color-stop(0%,#066ab8),color-stop(90%,#099fff));background:-moz-linear-gradient(center bottom,#066ab8 0%,#099fff 100%);border-color:#0777cf;box-shadow:inset 0px 1px 2px #0770c3,0px 0px 0px #000;border-top-color:#0775ca;border-left-color:#0775ca;border-right-color:#087edb;border-bottom-color:#087edb;}.fish_button_highlight{border:1px solid green;box-shadow:inset 0 1px 3px rgba(255,255,255,0.2),0 0 3px rgba(0,0,0,0.3);text-shadow:.0em .1em .1em rgba(50,50,50,0.8);-webkit-transition:all linear 0.2s;-moz-transition:all linear 0.2s;color:#fff;line-height:normal;margin:0 5px;background:-webkit-linear-gradient(#228F38,#5BC05B);background:-moz-linear-gradient(#228F38,#5BC05B);background:linear-gradient(#228F38,#5BC05B);border-color:green;}.fish_button_highlight:hover{background:-webkit-linear-gradient(#2FBB4C,#70E270);background:-moz-linear-gradient(#2FBB4C,#70E270);background:linear-gradient(#2FBB4C,#70E270);}.fish_button:disabled{background:-webkit-gradient(linear,left bottom,left top,color-stop(0%,#B7C0C9),color-stop(90%,#777777));background:-moz-gradient(linear,left bottom,left top,color-stop(0%,#B7C0C9),color-stop(90%,#777777));color:#ccc;border-color:#777;}tr.steps td{background-color:#E8B7C2!important;-webkit-transition:all linear 0.1s;-moz-transition:all linear 0.1s}tr.stepsok td{background-color:#BDE5BD!important;-webkit-transition:all linear 0.1s;-moz-transition:all linear 0.1s}tr.steps span.indicator{display:inline-block!important}tr.stepsok span.indicator{display:inline-block!important}.highlightrow td{background-color:#D0C0ED!important;color:red}#randCodeTxt{font-weight:bold;font-size:18px;text-align:center;padding:3px 10px 3px 10px;font-family:verdana!important;text-transform:uppercase}tr.append_row{font-family:'Microsoft Yahei','Apple LiGothic Medium',Arial,Helvetica,Sans-serif;}#acathur{color:#fcfcfc;font-weight:bold;font-family:Segoe UI,Lucida Grande,Arial,Helvetica,Sans-serif;text-decoration:underline;text-shadow:0 0 1px #000,0px 0px 6px rgba(0,0,0,0.8);}div.gridbox_light .odd_light,div.gridbox_light .ev_light{background:-webkit-linear-gradient(#fff,#f6f6f6);background:-moz-linear-gradient(#fff,#f6f6f6);text-shadow:.0em .1em .1em rgba(255,255,255,0.8);}.validCell{ background:-webkit-linear-gradient(#e0ebff, #c7d9ff)!important; background:-moz-linear-gradient(#e0ebff, #c7d9ff)!important; color:green; }.validRow{background:-webkit-linear-gradient(#ffe0e5, #ffc7d0)!important;background:-moz-linear-gradient(#ffe0e5, #ffc7d0)!important;color:#700012;}.unValidRow{opacity:0.8;}.unValidCell{opacity:0.8;}.btn130_2 {text-shadow:none;}.warning{color:red;}input[type=checkbox].current{color:red;font-weight:bold;}span.leftTicketStatusSpan{color:green; font-weight:bold;}.gridtb { width:100%!important; }.gridtb th {text-align:center;padding: 5px; border-right: 1px solid #ccc; font-weight:bold;-webkit-transition:all linear 0.2s;-moz-transition:all linear 0.2s;background:-webkit-linear-gradient(#fafafa,#f0f0f0 90%);background:-moz-linear-gradient(#fafafa,#f0f0f0 90%);background-color:#fafafa;}.gridtb .last {border-right:none;}.gridtb td {border-right: 1px dotted #ccc; border-bottom: 1px solid #ccc; padding:5px; text-align: center;}.gridtb div {text-align:center;}#footRow {border-bottom:none; text-align: left;}.gridtb a{display:block; text-align:center;}.fish_opt {width:98%;padding:5px;margin:0;overflow:hidden;box-shadow:1px 1px 3px #ccc;border:1px solid #ddd;background-color:#fff;}.fish_opt li{width:175px; float:left;}.fishDialog {border-radius: 10px;  box-shadow: #7E9BCB 5px 5px 10px; width: 500px; display: none;}.fishDialogTitle { font-size:120%; line-height: 30px; text-align: center;font-weight: bold;color: #fff;background: -webkit-linear-gradient(#7292C6, #40649F);background: -moz-linear-gradient(#7292C6, #40649F); border-radius: 6px 6px 0 0;}.fishDialogContent { background-color: #fff; padding: 15px; }.fishDialogControls { padding: 2px;background-color: #f0f0f0;text-align: right; border-radius: 0 0 6px 6px; }.fishDialogMask{position:fixed;left:0;top:0;background-color:#4e7896;opacity:.5;z-index:9999;width:100%;display:block;-moz-background-size:40px 40px;-o-background-size:40px 40px;-webkit-background-size:40px 40px;background-size:40px 40px;background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.1) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.1) 50%,rgba(255,255,255,.1) 75%,transparent 75%,transparent);background-image:-moz-linear-gradient(45deg,rgba(255,255,255,.1) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.1) 50%,rgba(255,255,255,.1) 75%,transparent 75%,transparent);}";document.head.appendChild(n)}function injectDom(){var n=[],i,r,t,u;if(n.push('<div id="fishOption" style="width: 600px; display:none; box-shadow: 7px 7px 10px rgb(126, 146, 188);">'),n.push('<div class="innerTab">'),n.push('<ul class="tabNav" default="tabVersion">'),n.push('<li tab="tabLogin">常规设置<\/li>'),n.push('<li tab="tabReg">注册<\/li>'),n.push('<li tab="tabFaq">常见问题<\/li>'),n.push('<li tab="tabVersion">版本信息<\/li>'),n.push('<li tab="tabLoginIE">登录到IE<\/li>'),n.push("<\/ul>"),n.push('<div class="tabContent tabLogin">'),n.push('<table style="width:100%;">'),n.push('<colgroup><col style="width:10%;" /><col style="width:23%;" /><col style="width:10%;" /><col style="width:23%;" /><col style="width:10%;" /><col style="width:24%;" /><\/colgroup><tr>'),n.push("<td>重试时间 "),n.push("<\/td>"),n.push('<td><input type="text" name="login.retryLimit" size="6" value="2000" />'),n.push("(ms)<\/td>"),n.push("<td>等待时间"),n.push("<\/td>"),n.push("<td><input style='width:40px;text-align:center;' title='刷新的时候有个固定的5秒间隔，在此基础上叠加一个0到<本值>的随机时间。' type='number' min='0' value='5' size='4' id='refereshInterval' name='refereshInterval' style='text-align:center;' />秒<\/td>"),n.push("<td colspan='2'><\/td><\/colspan><\/tr>"),n.push("<tr><td>自动展开<\/td><td colspan='3'><label><input type='checkbox' name='query.autoexpand' value='1' />查询的车次结果尽可能显示为最高<\/label><\/td><\/tr>"),n.push("<\/table>"),n.push("<\/div>"),n.push('<div class="tabContent tabReg" style="text-indent: 20px">'),n.push("<p>为了阻止地球人他喵地拿作者无偿奉献的助手去卖钱钱，请注册唷。<strong>完全免费申请<\/strong>。<\/p>"),n.push('<p style="color: red;"> <strong style="font-size:16px;">亲，本助手完全免费。。。<\/strong>任何在第三方网站上出售的软件全是山寨的……看到的时候请亲务必退款退货扔差评。。。<\/p>'),n.push('<p style="color:purple;"> 回家是一个单纯而简单的心愿，希望我们不会变得太复杂……<\/p>'),n.push("<p>任何版本之间，功能上没有任何区别，So……不要问作者万一资助的话会有神马新功能，木有的说…… (=￣ω￣=) <\/p>"),n.push('<p class="registered" style="display:none;">很高兴认识你，<strong>fishcn@foxmail.com<\/strong>，谢谢你的出现~~~~已注册版本：<strong>正式版<\/strong>【<a href="javascript:;" id="unReg">重新注册<\/a>】<\/p>'),n.push('<table class="regTable" style="display:none;width:98%;">'),n.push("<tr>"),n.push('<td>请粘贴注册码 【<a href="http://www.fishlee.net/Apps/Cn12306/GetNormalRegKey?v=1" target="_blank" style="color:blue;font-weight:bold;text-decoration:underline;">戳我直接申请注册码啊！为什么你们舍不得戳我啊 ╮(╯▽╰)╭<\/a>】<\/td>'),n.push("<\/tr><tr>"),n.push('<td style="text-align:center;"><textarea id="regContent" style="width:98%; height:50px;"><\/textarea><\/td>'),n.push("<\/tr><tr>"),n.push('<td><input type="button" id="regButton" value="注册" /><\/td>'),n.push("<\/tr>"),n.push("<\/table>"),n.push("<\/div>"),n.push('<div class="tabContent tabVersion" style="text-indent: 20px">'),n.push('<h4 style="font-size:18px; font-weight:bold; margin: 0px; line-height: 26px; border-bottom: 1px dotted #ccc;">12306 订票助手 <small>ver '+window.helperVersion+"<\/small><\/h4>"),n.push("<p> 12306 订票助手是一款用于订票的助手软件，"+(utility.isLieBaoEdition?"您正在使用的是为<strong>猎豹浏览器<\/strong>特别定制的版本":"嗯……看到这里相信你已经知道它支持神马浏览器了")+" =。=<strong>完全免费，无需付费使用，仅接受捐助。<\/strong> <\/p>"),n.push('<p style="color: red;"> <strong style="font-size:16px;">亲，本助手完全免费。。。<\/strong>任何在第三方网站上出售的软件全是山寨的……看到的时候请亲务必退款退货扔差评。。。<\/p>'),n.push('<p style="color:purple;"> 回家是一个单纯而简单的心愿，希望我们不会变得太复杂……<\/p>'),n.push('<p> 有很多朋友资助作者，小的感激涕零 ≥ω≤。<a href="http://www.fishlee.net/soft/44/donate.html" target="_blank">戳这里了解捐助详情<\/a>。 <\/p>'),n.push('<p style="font-weight:bold;">当前版本更新内容<\/p>'),n.push("<ol >"),$.each(utility.getPref("updates").split("\t"),function(t,i){n.push("<li style='padding:0 0 6px 20px;list-style:none;'>"+i+"<\/li>")}),n.push("<\/ol>"),n.push("<\/div>"),n.push('<div class="tabContent tabFaq">'),n.push("<table>"),n.push("<tr>"),n.push('<td colspan="4"> 你在订票过程中可能……会遇到各种问题，由于介个12306网站本身呢……木有没有任何介绍 ╮(╯▽╰)╭ ，所以老衲整理了相关问题，供客官参考。如果还有不明白的问题，加群讨论呗  (=￣ω￣=) 。 <br /><br />'),n.push('1.放票非正点也，So在将近放票的时候，务必保持刷新状态哈，而且……当整点没有放票时，不要放弃继续刷新喔；<br />2.动车都是11点放票撒，切记切记；<br />3.第一波放票悲催地木有订到时，请耐心等待，因为现在放票有N多节点，随时会有票出来，晚很久才放票也正常，铁老大经常秀下限嘀；<br />4.如果您的车票很难买，请尽量发动你的七大姑八大姨神马的一堆朋友过来集体帮忙，同时建议用多个浏览器刷票，因为缓存的关系不同的浏览器出现票的时间可能不同；<br />好了，废话说完鸟，祝大家买票顺利，贫僧只希望不会帮倒忙就好了 ╮(╯▽╰)╭<br />如果您还有问题的话，<a href="http://www.fishlee.net/soft/44/tour.html" target="_blank">建议点击这里查看教程~~~~<\/a>'),n.push("<\/td><\/tr>"),n.push('<tr style="display:none;">'),n.push('<td><a href="http://www.fishlee.net/soft/44/12306faq.html" target="_blank">订票常见问题<\/a><\/td>'),n.push('<td><a href="http://www.fishlee.net/soft/44/faq.html" target="_blank">助手运行常见问题<\/a><\/td>'),n.push("<\/tr>"),n.push("<\/table>"),n.push("<\/div>"),n.push('<div class="tabLoginIE tabContent"><div><strong>先在IE中打开 https://dynamic.12306.cn/otsweb，<\/strong>再将以下代码复制到IE浏览器的地址栏。确认地址栏最前面有“javascript:”字样，没有请手动加上（IE10会自动删除这样的代码），然后敲回车，等待页面刷新后，即可自动登录。<\/div><textarea id="LoginIECode" style="width:100%;height:200px;"><\/textarea><\/div>'),n.push('<div class="control">'),n.push('<input type="button" class=" fish_button close_button" value="关闭" />'),n.push("<\/div>"),n.push("<\/div>"),n.push("<\/div>"),$("body").append(n.join("")),i=$("#fishOption"),$("#regButton").click(function(){var t=$.trim($("#regContent").val()),n=utility.verifySn(!1,"",t);if(n.result!=0)alert("很抱歉, 注册失败. 代码 "+n.result+", "+n.msg);else{utility.setSnInfo("",t);alert("注册成功, 请刷新浏览器。\n注册给 - "+n.name+" , 注册类型 - "+n.typeDesc.replace(/<[^>]*>/gi,""));try{utility.getTopWindow().location.reload()}catch(i){alert("权限不足无法刷新页面， 请手动刷新当前页！")}}}),$("#unReg, a.reSignHelper").live("click",function(){if(utility.regInfo.partner!=1&&utility.regInfo.result==0&&utility.regInfo.type!="DEMO"){if(!confirm("确定要重新注册吗?"))return;utility.setSnInfo("","");utility.getTopWindow().location.reload()}else utility.getTopWindow().utility.showOptionDialog("tabReg")}),utility.configTab=utility.fishTab(i),i.find("input[name]").each(function(){var n=$(this),i=n.attr("name"),t=window.localStorage.getItem(i);t&&(n.attr("type")=="checkbox"?n.attr("checked",t=="1"):n.val(t))}).change(function(){var n=$(this),t=n.attr("name");n.attr("type")=="checkbox"?window.localStorage.setItem(t,n[0].checked?1:0):window.localStorage.setItem(t,n.val())}),$("#configLink, .configLink").live("click",function(){var t=$(this),n=t.attr("tab");console.log("require to show tab "+n);utility.getTopWindow().utility.showLoginIE();utility.getTopWindow().utility.showOptionDialog(n||"")}),utility.getPref("helperVersion")!=window.helperVersion){utility.clearFeatrueDisabled();r=["ontimequeuecount"];utility.isAdvancedSupport()||r.push("ontimeleftticket");utility.setPref("disabled",r.join("|"));utility.disabledFeaturesCache=null,function(){var t=new Date,n;for(t.setTime(t.getTime()-1e3),n=0;n<arguments.length;n++)document.cookie=arguments[n]+"=; path=/; domain=.12306.cn; expires="+t.toGMTString()}("helper.regUser","helper.regSn");utility.setPref("pas","");(utility.getAudioUrl().indexOf("github")!=-1||utility.getAudioUrl().indexOf("resbak.")!=-1)&&utility.resetAudioUrl();utility.setPref("helperVersion",window.helperVersion);try{parent==self&&utility.showOptionDialog("tabVersion")}catch(f){utility.showOptionDialog("tabVersion")}}$(".resetFuncFlag").live("click",function(){var t=this.dataset.function,n=$.inArray(t,utility.disabledFeatures());n!=-1&&(utility.disabledFeaturesCache.splice(n,1),utility.disableFeature(),utility.getTopWindow().location.reload())});t=utility.verifySn(!0);t.result==0&&t.type!="DEMO"&&(u=i.find(".registered").show().find("strong"),u.eq(0).html(t.name),u.eq(1).html(t.typeDesc));(t.partner==1||t.result!=0||t.type=="DEMO")&&(i.find(".regTable").show(),t.result!=0&&(location.pathname=="/otsweb/"||location.pathname=="/otsweb/main.jsp")&&(alert("为了阻止地球人趁火打劫然后拿着老衲免费奉献的东东去卖钱，贫僧斗胆麻烦客官……啊不，施主注册下下，一下子就好了啦！"),window.open("http://www.fishlee.net/Apps/Cn12306/GetNormalRegKey"),utility.showOptionDialog("tabReg")));utility.regInfo=t;$(".dismiss_button").live("click",function(){var n=$(this),t="msg_"+n.attr("data-target");confirm("确定要隐藏此提示咩？如果隐藏，直到下次版本升级前，都是不会再显示的喔。")&&(utility.setPref(t,window.helperVersion),$("#"+n.attr("data-target")).hide())})}function finishUi(){$(".dismiss_button").each(function(){var n=$(this),t="msg_"+n.attr("data-target");utility.getPref(t)==window.helperVersion&&$("#"+n.attr("data-target")).hide()})}function unsafeInvoke(n){var t=document.createElement("script");t.type="text/javascript";t.textContent=buildCallback(n);document.head.appendChild(t)}function buildCallback(n){var i="",t;return utility_emabed||(i+="window.helperVersion='"+version+"'; window.compVersion='"+compVersion+"'; if(typeof(window.utility)!='undefined' &&(!utility.isSogou&&!utility.isMaxthon)){ alert('喵……您似乎同时运行了两只助手! 请转到『附加组件管理『（Firefox）或『扩展管理』（Chrome）中卸载老版本的助手。。。');}; \r\nwindow.utility="+buildObjectJavascriptCode(utility)+"; window.utility.init();\r\n",utility_emabed=!0),typeof n=="function"&&(t=n.name),t||(t=Math.random()+""),i+("("+buildObjectJavascriptCode(n)+")();"+(isDebug?"\r\n//@ sourceURL=http://www.fishlee.net/soft/44/scripts/"+t+".js":""))}function buildObjectJavascriptCode(n){var u,t,i,r,f;if(n==null)return"null";if(typeof n=="undefined")return"undefined";if(u=typeof n,u=="string")return'"'+n.replace(/(\r|\n|\\)/gi,function(n,t){switch(t){case"\r":return"\\r";case"\n":return"\\n";case"\\":return"\\\\"}})+'"';if(u!="object")return n+"";t=[];for(i in n)r=n[i],f=typeof r,f=="object"||f=="string"?t.push(i+":"+buildObjectJavascriptCode(r)):t.push(i+":"+r);return"{"+t.join(",")+"}"}function initialzeAndStartup(){utility.setPref("updates",updates.join("\t"));checkDefaultOption();initUIDisplay();unsafeInvoke(injectDom);entryPoint();checkUpdate()}function entryPoint(){var n=window.location,t=n.pathname,u,r,i;if(utility.regInfo=utility.verifySn(!0),utility.regInfo.result!=0,unsafeInvoke(autoReloadIfError),(t=="/otsweb/loginAction.do"&&n.search!="?method=initForMy12306"||t=="/otsweb/login.jsp")&&(unsafeInvoke(initLogin),mapTabIndex(["UserName","password","randCode","subLink"])),utility.regInfo.bindAcc&&localStorage.getItem("_sessionuser")&&utility.regInfo.bindAcc.length>0&&utility.regInfo.bindAcc[0]&&utility.regInfo.bindAcc[0]!="*"){for(u=localStorage.getItem("_sessionuser"),r=!1,i=0;i<utility.regInfo.bindAcc.length;i++)if(utility.regInfo.bindAcc[i]==u){r=!0;break}if(!r)return}t=="/otsweb/order/querySingleAction.do"&&(n.search=="?method=init"&&document.getElementById("submitQuery")&&injectQueryScripts(),n.search=="?method=submutOrderRequest"&&unsafeInvoke(initSubmitOrderQuest));t=="/otsweb/order/orderAction.do"&&n.search.indexOf("method=cancelMyOrderNotComplete")!=-1&&document.getElementById("submitQuery")&&injectQueryScripts();t=="/otsweb/order/payConfirmOnlineSingleAction.do"&&n.search.indexOf("method=cancelOrder")!=-1&&document.getElementById("submitQuery")&&injectQueryScripts();t=="/otsweb/order/myOrderAction.do"&&(n.search.indexOf("method=resign")!=-1&&document.getElementById("submitQuery")&&injectQueryScripts(),n.search.indexOf("queryMyOrder")!=-1&&unsafeInvoke(queryMyOrder));(t=="/otsweb/order/confirmPassengerAction.do"||t=="/otsweb/order/confirmPassengerResignAction.do")&&(n.search=="?method=init"&&(unsafeInvoke(initAutoCommitOrder),unsafeInvoke(autoCommitOrderInSandbox)),n.search.indexOf("?method=payOrder")!=-1&&(unsafeInvoke(initPagePayOrder),unsafeInvoke(utility.enableLoginIE)));t=="/otsweb/order/myOrderAction.do"&&(n.search.indexOf("?method=laterEpay")!=-1||n.search.indexOf("?method=queryMyOrderNotComplete")!=-1)&&(unsafeInvoke(initNotCompleteOrderPage),unsafeInvoke(initPayOrder),unsafeInvoke(utility.enableLoginIE));t=="/otsweb/passengerAction.do"&&n.search.indexOf("?method=initUsualPassenger")!=-1&&unsafeInvoke(storePasToLocal);t=="/otsweb/main.jsp"||t=="/otsweb/"?(unsafeInvoke(injectMainPageFunction),document.body.addEventListener("notify",function(n){var i=n.detail,t=i.msg,r=i.title,u=i.timeout,f;if(typeof GM_notification!="undefined"){GM_notification(t);return}if(typeof chrome!="undefined"&&typeof chrome.extension!="undefined"){chrome.extension.sendRequest({"function":"notify",message:t,timeout:u,title:r});return}if(typeof sogouExplorer!="undefined"&&typeof sogouExplorer.extension!="undefined"){sogouExplorer.extension.sendRequest({"function":"notify",message:t,timeout:u,title:r});return}f=webkitNotifications.createNotification("http://www.12306.cn/mormhweb/images/favicon.ico",r||"订票助手",t);setTimeout(function(){f.close()},u||5e3);f.show()})):(console.log("[INFO] 初始化框架高度自动调整"),unsafeInvoke(function(){var t=$("div.conWrap"),i,n;t.length==1&&(i=parent.$("#main"),n=0,setInterval(function(){var r=t.height();r!=n&&(n=r,i.height(n+10),parent.window.setHeight(parent.window))},500))}));unsafeInvoke(finishUi)}function injectQueryScripts(){unsafeInvoke(initTicketQuery);unsafeInvoke(initAutoPreSubmitOrder);unsafeInvoke(initAdvancedTicketQuery);unsafeInvoke(initDirectSubmitOrder);unsafeInvoke(dgFilterQuery);unsafeInvoke(initQueryGuide)}function queryMyOrder(){$(".table_clist").each(function(){var n=$(this);n.find("tr:gt(0):not(.table_plgq)").each(function(){var i=$(this),n=i.find("td:eq(3)"),r=n.html(),t=/<!--\s*(.+?)-->/i.exec(r);t[1]&&n.append(t[1])})})}function initNotCompleteOrderPage(){if(utility.checkCompatible(),OrderQueueWaitTime&&OrderQueueWaitTime.prototype.getWaitTime){var n=/url\s*:\s*['"]([^'"]+)['"]/i.exec(OrderQueueWaitTime.prototype.getWaitTime+"")[1];n&&function(){function i(){var r=t.shift();t.push(r);utility.get(n,{tourFlag:r},"json",function(n){var t=$("#status_"+r);if(n.waitTime==0||n.waitTime==-1){t.css({color:"green"}).html("订票成功！");utility.notify("订票成功！请尽快付款！");parent.playAudio();self.location.reload();return}if(n.waitTime==-2){utility.notify("出票失败！请重新订票！"+n.msg);parent.playFailAudio();t.css({color:"red"}).html("出票失败！"+n.msg);return}if(n.waitTime==-3){utility.notify("订单已经被取消！");parent.playFailAudio();t.css({color:"red"}).html("订单已经被取消！！");return}n.waitTime==-4&&(utility.notify("正在处理中...."),t.css({color:"blue"}).html("正在处理中...."));n.waitTime>0?t.css({color:"red"}).html("等待开奖中<br />排队数【"+(n.waitCount||"未知")+"】<br />预计时间【"+utility.getSecondInfo(n.waitTime)+"】<br />不过这时间不<br />怎么靠谱 ╮(╯▽╰)╭"):t.css({color:"red"}).html("奇怪的状态码 ["+n.waitTime+"]....");setTimeout(i,2e3)},function(){utility.notify("查询状态错误，正在刷新页面！");self.location.reload()})}var r=$("input[name=cache_tour_flag]"),t=$.map(r,function(n){return n.value});$.each(t,function(){$("#showTime_"+this).hide().after("<span id='status_"+this+"'>正在查询...<\/span>")});t.length>0&&i()}()}}function initSubmitOrderQuest(){$("div.error_text").length>0&&parent.window.resubmitForm()}function initPagePayOrder(){new Audio(utility.getAudioUrl()).play()}function autoReloadIfError(){$.trim($("h1:first").text())=="错误"&&($("h1:first").css({color:"red","font-size":"18px"}).html("&gt;_&lt; 啊吖!，敢踹我出门啦。。。2秒后我一定会回来的 ╮(╯▽╰)╭"),setTimeout(function(){self.location.reload()},2e3))}function injectMainPageFunction(){var n=$("#main")[0];n.onload=function(){var t=null;try{t=n.contentWindow.location+""}catch(i){}t&&t!="http://www.12306.cn/mormhweb/logFiles/error.html"||resubmitForm()};window.resubmitForm=function(){var n=$("#orderForm");n.length!=0&&n.attr("success")=="0"&&(utility.notify("页面出错了！正在重新预定！"),setTimeout(function(){document.getElementById("orderForm").submit()},3e3))};window.playAudio=function(){new Audio(utility.getAudioUrl()).play()};window.playFailAudio=function(){utility.playFailAudio()}}function initAutoCommitOrder(){function t(t){n(!1,"错误 - "+t);k(t);$("div.tj_btn button, div.tj_btn input").each(function(){this.disabled=!1;$(this).removeClass().addClass("long_button_u")});$("#btnCancelAuto").hide();f=!1}function e(){if(window.isSafeMobeBlocked){n(!0,"正在等安全期再上……╮(╯▽╰)╭");return}if(l[0].blur(),$(document).trigger("stopcheckcount"),!window.submit_form_check||!submit_form_check("confirmPassenger")){n(!1,"您的表单没有填写完整!");t("请填写完整表单");return}if(h++,n(!0,"第 "+h+" 次试着买彩票"),i){t("已取消自动提交");i=0;return}$("#btnCancelAuto").show().removeClass().addClass("long_button_u")[0].disabled=!1;i=0;p=!1;$("#confirmPassenger").ajaxSubmit({url:d+$("#rand").val(),type:"POST",data:{tFlag:c},dataType:"json",timeout:1e4,success:function(i){"Y"!=i.errMsg||"N"==i.checkHuimd||"N"==i.check608?(n(!1,i.msg||i.errMsg),t(i.msg||i.errMsg),r()):tt()},error:function(){n(!1,"当前请求发生错误");utility.delayInvoke(null,e,1e3)}})}function tt(){var i={train_date:$("#start_date").val(),train_no:$("#train_no").val(),station:$("#station_train_code").val(),seat:$("#passenger_1_seat").val(),from:$("#from_station_telecode").val(),to:$("#to_station_telecode").val(),ticket:$("#left_ticket").val()};utility.get(g,i,"json",function(i){if(i.op_2){var u="系统说人多，不许买彩票了，看起来没办法了……重新输入验证码试试 (据说人数="+i.count+")";n(!0,u);t(u);r();return}setTimeout(ut,1e3)},function(){utility.delayInvoke(null,tt,2e3)})}function ut(){jQuery.ajax({url:v,data:$("#confirmPassenger").serialize(),type:"POST",timeout:1e4,dataType:"json",success:function(i){console.log(i);var u=i.errMsg;if(u!="Y"){if(u.indexOf("包含未付款订单")!=-1){alert("您有未支付订单! 等啥呢, 赶紧点确定支付去.");window.location.replace("/otsweb/order/myOrderAction.do?method=queryMyOrderNotComplete&leftmenu=Y");return}if(u.indexOf("重复提交")!=-1){t("重复提交错误，已刷新TOKEN，请重新输入验证码提交");s();r();return}if(u.indexOf("后台处理异常")!=-1||u.indexOf("非法请求")!=-1){o?(utility.notify("后台处理异常，已自动重新提交表单，请填写验证码并提交！"),o.submit()):t("后台处理异常，请返回查询页重新预定！");return}if(u.indexOf("包含排队中")!=-1){console.log("惊现排队中的订单， 进入轮询状态");w();return}n(!1,u);t(u);r()}else utility.notify("彩票已买下, 正在等待开奖，请及时注意开奖状态"),w()},error:function(){n(!1,"当前请求发生错误");utility.delayInvoke(null,e,3e3)}})}function s(){n(!0,"正在刷新TOKEN....");utility.get(self.location+"",null,"text",function(t){if(/TOKEN"\s*value="([a-f\d]+)"/i.test(t)){var i=RegExp.$1;n(!1,"已获得TOKEN - "+i);console.log("已刷新TOKEN="+i);$("input[name=org.apache.struts.taglib.html.TOKEN]").val(i)}else n(!1,"无法获得TOKEN，正在重试"),utility.delayInvoke("#countEle",s,1e3);rt.restart()},function(){utility.delayInvoke("#countEle",s,1e3)})}function w(){n(!0,"彩票提交成功，请等待开奖....");$.ajax({url:nt,data:{tourFlag:c},type:"GET",timeout:1e4,dataType:"json",success:function(i){var u;console.log(i);i.waitTime==-1||i.waitTime==0?(utility.notify("中奖咯!"),i.orderId?window.location.replace("/otsweb/order/confirmPassengerAction.do?method=payOrder&orderSequence_no="+i.orderId):window.location.replace("/otsweb/order/myOrderAction.do?method=queryMyOrderNotComplete&leftmenu=Y"),t("中奖咯！")):i.waitTime==-3?(u="很抱歉, 铁道部无齿地撤销了您的订单, 赶紧重新下!",utility.notify(u),n(!1,u),t(u),r()):i.waitTime==-2?(u="很抱歉, 铁道部说您占座失败 : "+i.msg+", 赶紧重新来过! 当长时间出现占座失败时, 建议您更改车次!",s(),utility.notify(u),n(!1,u),t(u),r()):i.waitTime<0?(u="很抱歉, 未知的状态信息 : waitTime="+i.waitTime+", 可能已成功，请验证未支付订单.",k(u),utility.notify(u),location.href="/otsweb/order/myOrderAction.do?method=queryMyOrderNotComplete&leftmenu=Y"):(u="彩票还要 "+utility.getSecondInfo(i.waitTime)+" 开奖， 请等待，不过你知道的，铁道部说的一直不怎么准。（排队人数="+(i.waitCount||"未知")+"）",i.waitTime>1800&&(u+="<span style='color:red; font-weight: bold;'>警告：排队时间大于30分钟，请不要放弃电话订票或用小号重新排队等其它方式继续订票！<\/span>"),k(u),i.waitTime>1800&&!p&&(p=!0,utility.notify("警告！排队时间大于30分钟，成功率较低，请尽快电话订票或用小号重新排队！")),utility.delayInvoke("#countEle",w,3e3))},error:function(){utility.notify("请求发生异常，可能是登录状态不对，请验证。如果没有问题，请手动进入未完成订单页面查询。");self.location.reload()}})}function n(n,t){var i=$("#countEle");i.removeClass().addClass(n?"fish_running":"fish_clock").html(t||(n?"正在操作中……":"等待中……"))}function k(n){b.eq(2).find("span").html(utility.getTimeInfo());b.eq(1).find("span").html(n)}function it(){var n=localStorage.getItem("preSelectPassenger")||"",t=(localStorage.getItem("autoSelect_preSelectSeatType")||"").split("|")[0];n&&(n=n.split("|"),$.each(n,function(){return this?(console.log("[INFO][自动选择乘客] 自动选定-"+this),$("#"+this+"._checkbox_class").attr("checked",!0).click().attr("checked",!0),!0):!0}),t&&$(".passenger_class").each(function(){$(this).find("select:eq(0)").val(t).change()}))}var o,b,ft,u,rt;utility.checkCompatible();var h=0,i=0,f=!1,c=/'(dc|fc|wc|gc)'/.exec($("div.tj_btn :button:last")[0].onclick+"")[1]||"dc",l=$("#rand"),a=new Date;if($(".error_text").length>0&&parent.$("#orderForm").length>0){parent.resubmitForm();return}var d=/url\s*:\s*['"]([^'"]+)['"]/i.exec(submit_form_confirm+"")[1],g=/url\s*:\s*['"]([^'"]+)['"]/i.exec(showOrderDialog+"")[1],v=new RegExp("tourFlag\\s*==\\s*['\"]"+c+"['\"](.|\\s)+?['\"]([^'\"]+)['\"]","i").exec(queueOrder+"")[2],nt=/url\s*:\s*['"]([^'"]+)['"]/i.exec(OrderQueueWaitTime.prototype.getWaitTime+"")[1],y=d&&g&&v&&nt;y||alert("嗯……看起来木有找到相关提交地址……so……自动提交已被自动禁用来着……");console.log("[CONFIRM URL] "+v);var r=function(){$("#img_rrand_code").click();$("#rand").val("")[0].select()},et=function(){return 1e3*Math.max(parseInt($("#pauseTime").val()),1)},p=!1;y&&($("div.tj_btn").append("&nbsp;&nbsp;<button class='long_button_u' type='button' id='btnAutoSubmit'>自动提交<\/button> <button class='long_button_u' type='button' id='btnCancelAuto' style='display:none;'>取消自动<\/button>"),$("#btnAutoSubmit").click(function(){h=0;i=0;f=!0;e()}),$("#btnCancelAuto").click(function(){$(this).hide();i=1;f=!1}),l.keyup(function(n){document.getElementById("autoStartCommit").checked&&!i&&(n.charCode==13||l.val().length==4)&&(f=!0,e())}));o=null;parent&&(o=parent.$("#orderForm"),o.attr("success","1"));$("#rand").closest("tr").after("<tr><td style='border-top:1px dotted #ccc;height:100px;' colspan='9' id='orderCountCell'><\/td><\/tr><tr id='tiptr'><td style='border-top:1px dotted #ccc;' colspan='9'><ul id='tipScript'><li class='fish_clock' id='countEle' style='font-weight:bold;'>等待操作<\/li><li style='color:green;'><strong>操作信息<\/strong>：<span>休息中<\/span><\/li><li style='color:green;'><strong>最后操作时间<\/strong>：<span>--<\/span><\/li><\/ul><\/td><\/tr>");b=$("#tipScript li");ft=0;$("#tiptr").after("<tr><td colspan='9'><div style='display:;'>失败时休息时间：<input type='text' size='4' class='input_20txt' style='text-align:center;' value='3' id='pauseTime' />秒 (设置自动重新提交时的时间间隔不得低于1)  <\/div>安全期时间长度：<input type='text' size='4' class='input_20txt' style='text-align:center;' value='3' id='safeModeTime' />秒 (默认为 <span class='defaultSafeModeTime'><\/span>秒，可以更改试试，过短可能会导致提交时被铁道部踹出去……)  <div><label><input type='checkbox' id='autoStartCommit' /> 验证码戳完自动提交，不选就是你自己戳『提交订单』按钮咯——发生异常（提交不了订单等）的请取消勾选此选项唷<\/label><\/div><label><input type='checkbox' id='autoDelayInvoke' /> 启用安全模式——本页的自动提交会自动推迟到<span class='defaultSafeModeTime'><\/span>秒之后。如果你希望自己掐表，请取消勾选，注意哦，提交过快被铁道部踹出门的~<\/label><\/div><div><label><input type='checkbox' id='showHelp' /> 显示帮助<\/label><\/div><\/td><\/tr>");document.getElementById("autoStartCommit").checked=typeof window.localStorage.disableAutoStartCommit=="undefined";document.getElementById("showHelp").checked=typeof window.localStorage.showHelp!="undefined";document.getElementById("autoDelayInvoke").checked=typeof window.localStorage.autoDelayInvoke=="undefined";$("#autoStartCommit").change(function(){this.checked?window.localStorage.removeItem("disableAutoStartCommit"):window.localStorage.setItem("disableAutoStartCommit","1")});$("#autoDelayInvoke").change(function(){this.checked?window.localStorage.removeItem("autoDelayInvoke"):window.localStorage.setItem("autoDelayInvoke","1")});location.pathname.indexOf("Resign")==-1?$("#showHelp").change(function(){this.checked?(window.localStorage.setItem("showHelp","1"),$("table.table_qr tr:last").show()):(window.localStorage.removeItem("showHelp"),$("table.table_qr tr:last").hide())}).change():$("#showHelp").closest("div").hide();y||$("#pauseTime, #autoStartCommit").parent().hide();u=[],function(){var t=$("#passenger_1_seat option"),n=[];n.push("当前铺位状态查询：");t.each(function(){u.push({id:this.value,name:this.text});n.push("席位【<span style='color:blue; font-weight: bold;'>"+this.text+"<\/span>】余票数: <span class='leftTicketStatusSpan' id='leftTicketStatus_"+this.value+"'>等待查询<\/span>, 排队数: <span class='queueStatusSpan' id='queueStatus_"+this.value+"'>等待查询<\/span>")});$("#orderCountCell").html(n.join("<br />"))}();utility.isfeatureDisabled("ontimeleftticket")?$("span.leftTicketStatusSpan").html("(暂不支持查询或已禁用，<button class='lineButton resetFuncFlag' data-function='ontimeleftticket'>重新启用<\/button>)"):function(){function t(){if(!n){var r={"orderRequest.train_date":$("#start_date").val(),"orderRequest.from_station_telecode":$("#from_station_telecode").val(),"orderRequest.to_station_telecode":$("#to_station_telecode").val(),"orderRequest.train_no":$("#train_no").val(),trainPassType:"QB",trainClass:"QB#D#Z#T#K#QT#",includeStudent:"00",seatTypeAndNum:"","orderRequest.start_time_str":"00:00--24:00"};utility.get("/otsweb/order/querySingleAction.do?method=queryLeftTicket",r,"text",function(n){if(/(([\da-zA-Z]\*{5,5}\d{4,4})+)/gi.test(n)){var r=RegExp.$1;$.each(i,function(){var n=this.id,t=getTicketCountDesc(r,n);$("#leftTicketStatus_"+n).html(t+" ["+utility.getTimeInfo()+"]")});setTimeout(t,6e3)}},function(){},"ontimeleftticket","/otsweb/order/querySingleAction.do?method=init")}}var r={train_date:$("#start_date").val(),station:$("#station_train_code").val(),seat:"",from:$("#from_station_telecode").val(),to:$("#to_station_telecode").val(),ticket:$("#left_ticket").val()},n=!1,i=u.slice(0,u.length+1);$(document).bind("stopcheckcount",function(){n=!0});t()}();utility.isfeatureDisabled("ontimequeuecount")?$("span.queueStatusSpan").html("(暂不支持查询)"):function(){function e(){n||t.length>0&&i()}function i(){if(!n){var u=t.shift();t.push(u);r.seat=u.id;utility.get(f,r,"json",function(n){var t="<span style='color:blue; font-weight: bold;'>"+n.count+"<\/span>，";t+=n.op_2?"<span style='color:blue; font-weight: red;'>排队人数已经超过余票数，可能无法提交<\/span>。":n.countT>0?"排队人数已超过系统参数，<span style='color:red; font-weight: bold;'>排队有危险<\/span>":"请尽快提交";t+=" ["+utility.getTimeInfo()+"]";$("#queueStatus_"+u.id).html(t);setTimeout(i,2e3)},function(){setTimeout(i,3e3)},"ontimequeuecount")}}var r={train_date:$("#start_date").val(),station:$("#station_train_code").val(),seat:"",from:$("#from_station_telecode").val(),to:$("#to_station_telecode").val(),ticket:$("#left_ticket").val()},f="confirmPassengerAction.do?method=getQueueCount",n=!1,t=u.slice(0,u.length+1);$(document).bind("stopcheckcount",function(){n=!0});e()}();$(window).ajaxComplete(function(n,t,i){i.url.indexOf("getpassengerJson")!=-1&&(console.log("[INFO][自动选择乘客] 系统联系人加载完成，正在检测预先选定"),it())});$("#showPassengerFilter div").length&&(console.log("[INFO][自动选择乘客] OOPS，居然加载完成了？直接选定联系人"),it()),function(){var n=document.getElementById("rand"),t=window.onload;window.onload=function(){t&&t();n.select()};n.select()}();rt=function(){function r(){window.isSafeMobeBlocked&&(window.isSafeMobeBlocked=!1,f&&e())}function h(){var i=(new Date-a)/1e3;i>=n?(t.html("保护期已过，你可以安全地提交订单鸟"),r()):(t.html("注入怨念中，等待"+n+"秒钟，建议稍等再提交订单"),window.isSafeMobeBlocked=!0)}$("#tipScript").append("<li style='color:green;' id='safeModeTip'><span><\/span>，已挤进预定页 <span><\/span> 秒……<\/li>");var u=$("#safeModeTip"),t=u.find("span:eq(0)"),s=u.find("span:eq(1)"),o=document.getElementById("autoDelayInvoke"),i=5,n=parseInt(utility.getPref("safeModeWaitTime"))||i;return $("span.defaultSafeModeTime").html(i),$("#safeModeTime").val(n).change(function(){n=parseFloat(this.value)||i;utility.setPref("safeModeWaitTime",n)}),window.isSafeMobeBlocked=o.checked,setInterval(function(){var i=(new Date-a)/100;s.html(Math.round(i)/10);o.checked&&(i>=n*10?(t.html("已达安全期，你可以试着提交订单鸟……不过说不定还是会中枪……"),r()):(t.html("注入怨念中，等待"+n+"秒钟，建议稍等再提交订单"),window.isSafeMobeBlocked=!0))},200),$("#autoDelayInvoke").change(function(){this.checked?h():(t.html("安全模式已关闭"),r())}).change(),this.restart=function(){a=new Date;$("#autoDelayInvoke").change()},this}()}function autoCommitOrderInSandbox(){window.localStorage.bookTip=="1"&&(window.Audio&&new window.Audio(utility.getAudioUrl()).play(),utility.notify("已经自动进入订票页面！请继续完成订单！"))}function initTicketQuery(){function k(){w=0;r&&(clearInterval(r),r=null);$("#refreshtimer").html("")}function st(){var n=(y-new Date)/1e3,i=Math.round(n*10)/10+"";($("#refreshtimer").html("["+(c?"等待正点,":"")+i+(i.indexOf(".")==-1?".0":"")+"秒后查询...]"),n>0)||(clearInterval(r),r=null,t.trigger("requery"),d())}function p(){var f,i,t,u;!r&&window.isInAutoRefreshMode()&&(f=(new Date).getMinutes(),i=0,document.getElementById("chkSmartSpeed").checked&&n&&n.getMinutes()>=59?(c=!0,i=62-n.getSeconds()):document.getElementById("chkWaitMode").checked&&(new Date).getHours()<parseInt(b.val())&&n?(t=new Date,t.setFullYear(n.getFullYear()),t.setMonth(n.getMonth()),t.setDate(n.getDate()),t.setHours(parseInt(b.val())),t.setMinutes(0),t.setSeconds(5),i=(t-n)/1e3,c=!0):(i=(parseInt(utility.getPref("refereshInterval"))||3)*Math.random()+5,c=!1),y=new Date,y.setSeconds(y.getSeconds()+i),u=Math.round(i*10)/10+"",$("#refreshtimer").html("["+(c?"等待正点,":"")+u+(u.indexOf(".")==-1?".0":"")+"秒后查询...]"),r=setInterval(st,200))}function ht(){w++;$("#refreshinfo").html("已刷新 "+w+" 次，最后查询："+utility.getTimeInfo());$("#refreshtimer").html("正在查询")}function d(){r=null;f&&f.pause();ht();sendQueryFunc.call(clickBuyStudentTicket=="Y"?document.getElementById("stu_submitQuery"):document.getElementById("submitQuery"))}function ct(n){return n.attr("trainCode")||$.trim($("td:eq(0)",n).text())}function rt(n){return document.getElementById("swBlackList").checked&&list_blacklist.isInRegList(n)&&!(document.getElementById("swWhiteList").checked&&list_whitelist.isInRegList(n))}function pt(){var n=$(this).closest("tr").attr("tcode");confirm("是否要将【"+n+"】加入自动预定列表？如果不是，请点击取消并继续选择是否加入黑名单或白名单。")?list_autoorder.add(n):confirm("是否要将【"+n+"】加入黑名单？如果不是，请点击取消并继续选择是否加入白名单。")?list_blacklist.add(n):confirm("是否要将【"+n+"】加入白名单？")&&list_whitelist.add(n)}var o,s,a,v,tt,e,h,n;orderButtonClass=".btn130_2";utility.checkCompatible();var l=!1,t=$(document),nt=$("#gridbox"),w=0,r=null,f=null,ut=$("form[name=querySingleForm] .cx_from:first");ut.find("tr:last").after("<tr class='append_row'><td colspan='8' id='queryFunctionRow'><ul id='queryOpt' style='margin-top:20px;border-radius:5px 5px 0px 0px;border-bottom:none;' class='fish_opt'>\t<li><label title='勾选的话，当有票可定时，助手会放歌骚扰你'><input type='checkbox' checked='checked' id='chkAudioOn'>声音提示<\/label><\/li>\t<li><label title='设置有票时放的歌是不是放到天荒地老至死不渝'><input type='checkbox' checked='checked' id='chkAudioLoop'>声音循环<\/label><\/li>\t<li style='font-weight:bold;color:#ff2020;' title='以服务器时间为准，未获得服务器时间之前，此选项不可用。启用智能加速模式时，在非正点附近时（大于0小于59分）按照正常速度刷新；当在正点附近时（大于等于59分时），暂停刷新并等到正点即刻刷新。'><label><input disabled='disabled' type='checkbox' id='chkSmartSpeed' />智能正点刷新模式<\/label><\/li>\t<li style='font-weight:bold;color:purple;' title='以服务器时间为准，未获得服务器时间之前，此选项不可用。此模式用于正点买票，启用后，在正点之前，助手不刷新，等到整点过5秒时，助手将会开始刷新。推荐您需要正点抢票的时候使用，此模式可以较好地避免频繁刷新带来的缓存问题……'><label><input disabled='disabled' type='checkbox' id='chkWaitMode' class='needServerTime' />等待整点刷新<\/label> <select id='waitHour'><\/select><\/li><\/ul><ul id='filterFunctionRow' style='border-top:none;border-radius:0px 0px 5px 5px;' class='fish_opt'>\t<li style='font-weight:bold;color:#ff2020;'><label title='不可以预定的车次过滤掉的选项（隐藏起来不显示，无票的车次）'><input type='checkbox' id='chkFilterNonBookable' />过滤不可预订的车次<\/label><\/li>\t<li style='font-weight:bold;color:#ff2020;'><label title='有时候虽然整趟车可以预定，但是有票的席别都是你不要的，如果勾选此选项，也将会过滤掉'><input type='checkbox' id='chkFilterNonNeeded' />过滤不需要的席别<\/label><\/li>\t<li style='font-weight:bold;color:blue;display: none;'><label><input disabled='disabled' type='checkbox' id='chkFilterByTrain' />开启按车次过滤<\/label><\/li><\/ul><\/td><td class='font_r' style='vertical-align:top;padding-top:20px;'><button class='fish_button' id='btnAutoRefresh' type='button' style='margin-right:0;width:97px;font-size:14px;display:block;margin-bottom:10px;'>♣ 刷普通票<\/button><button class='fish_button' id='btnAutoRefreshStu' style='margin-right:0;width:97px;font-size:14px;' type='button'>♠ 刷学生票<\/button><\/td><\/tr><tr class='append_row'><td colspan='9' id='opFunctionRow' style=''><input type='button' class='lineButton' disabled='disabled' value='停止声音' id='btnStopSound' /><input  type='button' class='lineButton' type='button' value='设置' id='configLink' tab='tabLogin' /> <input type='button' class='lineButton' id='resetSettings' value='清空助手设置' /> <input type='button' tab='tabLoginIE' class='lineButton configLink' value='IE登录' /> 【<a href='http://www.fishlee.net/soft/44/tour.html' style='color:#0abaff;font-weight:bold;' target='_blank'>戳这里看教程<\/a>】<\/td><\/tr><tr class='append_row'><td colspan='9' id='' style=''><span id='refreshinfo' style='text-shadow:1px 1px 1px #fff,0px 0px 2px rgba(0,0,0,0.2);'>已刷新 0 次，最后查询：--<\/span> <span id='refreshtimer'><\/span> <span style='margin-left:20px;color:purple;font-weight:bold;' id='serverMsg'><\/span><\/td><\/tr>");$(".in_fromr").css({"margin-right":"0px",width:"auto"}).find("ul li:first").before("<li><input type='button' id='chkSeatOnly' value='仅座票' class='lineButton' title='快速设置席别过滤按钮，点击后可快速勾选所有的座票，包括硬座软座一等座等等' /><input type='button' id='chkSleepOnly' value='仅卧铺' title='快速设置席别过滤按钮，点击后可快速勾选所有的卧铺，包括硬卧软卧什么的' class='lineButton' /><input type='button' id='chkAllSeat' value='全部席别' class='lineButton' title='快速勾选所有的席别' /><\/li>");window.Audio?$("#btnStopSound").click(function(){f&&f.pause();this.disabled=!0}):$("#chkAudioOn, #chkAudioLoop, #btnStopSound").remove();$("#resetSettings").click(function(){if(confirm("确定要清空助手的所有设置吗？"))return window.localStorage.clear(),self.location.reload(),!1});$("#chkSmartSpeed").change(function(){});var b=$("#waitHour"),ft=b[0],u=$("#btnAutoRefresh"),i=$("#btnAutoRefreshStu");for(o=6;o<24;o++)ft.options[o-6]=new Option(o+":00",o);u.click(function(){if(u.hasClass("fish_button_highlight"))u.removeClass().addClass("fish_button").html("♣ 刷普通票"),i.attr("disabled",!1),k();else{if(!canquery()||window.isInAutoRefreshMode())return!1;u.removeClass().addClass("fish_button_highlight").html("■ 停止刷票");i.attr("disabled",!0);clickBuyStudentTicket="N";t.trigger("requery");d()}return!1});i.click(function(){if(i.hasClass("fish_button_highlight"))i.removeClass().addClass("fish_button").html("♠ 刷学生票"),u.attr("disabled",!1),k();else{if(!canquery()||window.isInAutoRefreshMode())return!1;i.removeClass().addClass("fish_button_highlight").html("■ 停止刷票");u.attr("disabled",!0);clickBuyStudentTicket="Y";t.trigger("requery");d()}return!1});canBuyStudentTicket!="Y"&&i.remove();s=[];a={"3":"9","4":"P","5":"M","6":"O","7":"6","8":"4","9":"3","10":"2","11":"1","12":"empty","13":"QT"};$(".hdr tr:eq(2) td").each(function(n){var t,i,u,r;(s.push(!1),n<3)||(t=$(this),s[n]=(window.localStorage["typefilter_"+n]||"true")=="true",t.attr("otext",t.text()),i=$.trim(t.text()),i.length>2&&(i=i.replace("座","").replace("高级软卧","高软"),t.html(i)),u=$("<input id='seatoption_"+a[n]+"' type='checkbox' typecode='"+a[n]+"' name='seatoption'/>").attr("checked",s[n]),u[0].ticketTypeId=n,u.change(function(){s[this.ticketTypeId]=this.checked;window.localStorage["typefilter_"+this.ticketTypeId]=this.checked}).appendTo(t),r=nt.find(".xhdr"),r.length&&r.parent().height(r.height()),nt.find(".objbox").css("top",""))});$("#chkSeatOnly").click(function(){$(".hdr tr:eq(2) td").each(function(){var t=$(this),n=t.attr("otext");t.find("input").attr("checked",typeof n!="undefined"&&n&&n.indexOf("座")!=-1).change()})});$("#chkSleepOnly").click(function(){$(".hdr tr:eq(2) td").each(function(){var t=$(this),n=t.attr("otext");t.find("input").attr("checked",typeof n!="undefined"&&n&&n.indexOf("卧")!=-1).change()})});$("#chkAllSeat").click(function(){$(":checkbox[name=seatoption]").attr("checked",!0).change()});v=[];v.push("<div class='outerbox' id='helperbox'><div class='box'><div class='title' style='position:relative;'><big>12306订票助手<\/big>　　<label><input data-target='helpertooltable' id='enableAdvPanel' type='checkbox' />显示高级工具<\/label> <div class='time-comp' title='时间依赖于服务器时间即时计算。受限于您的网速，并不十分准确（需要扣除网速的影响）' id='servertime'>服务器时间：<strong>----<\/strong>，本地时间：<strong>----<\/strong>，服务器比本地 <strong>----<\/strong><\/div><\/div><table id='helpertooltable' style='width:100%;'><colgroup><col style='width:110px;' /><col style='width:370px;' /><col style='width:110px;' /><col style='width:auto;' /><\/colgroup><tr class='fish_sep fish_area' id='viewFilter'><td colspan='4'>查询过滤功能<\/span><\/tr><tr class='fish_sep fish_area' id='viewHelper'><td colspan='4'>查询辅助功能<\/span><\/tr><tr class='fish_sep fish_area' id='autoFill'><td colspan='4'>自动选择功能<\/span><\/tr><tr class='fish_sep fish_area' id='queryUtility'><td colspan='4'>其它辅助功能<\/span><\/tr><tr class='fish_sep musicFunc' id='helperbox_bottom'><td class='name'>自定义音乐地址<\/td><td colspan='3'><input type='text' id='txtMusicUrl' value='"+utility.getAudioUrl()+"' onfocus='this.select();' style='width:370px;' /> <button class='fish_button' id='btnSelectPresetAudio'>选择内置音乐<\/button> <button class='fish_button' id='btnTestAudio'>测试<\/button> <button class='fish_button' onclick='utility.resetAudioUrl(); document.getElementById(\"txtMusicUrl\").value=utility.getAudioUrl();'>恢复默认<\/button><\/td><\/tr>");v.push("<\/td><\/tr><\/table><table style='width:100%;'><tr class='fish_sep'><td class='tfooter' colspan='4'><a href='http://www.fishlee.net/soft/44/' target='_blank'>12306订票助手 @iFish<\/a> | <a href='http://weibo.com/Acathur' target='_blank'>美工设计 @Acathur<\/a> | 版本 v"+window.helperVersion+"<br /><a href='http://www.fishlee.net/soft/44/' style='color:blue;' target='_blank'>助手主页<\/a> | <a href='http://t.qq.com/ccfish/' style='color:blue;' target='_blank'>腾讯微博<\/a> | <a href='http://weibo.com/imcfish/' style='color:blue;' target='_blank'>新浪微博<\/a> | <a href='http://bbs.fishlee.net/' target='_blank' style='color:red;'>助手论坛<\/a> | <a href='http://www.fishlee.net/soft/44/announcement.html' style='color:#0f7edb;' target='_blank'>免责声明<\/a> | <a style='font-weight:bold;color:red;' href='http://www.fishlee.net/soft/44/donate.html' target='_blank'>捐助作者<\/a> | 许可于 <strong>"+utility.regInfo.name+"，类型 - "+utility.regInfo.typeDesc+"<\/strong> 【<a href='javascript:;' class='reSignHelper'>重新注册<\/a>】<\/td><\/tr>\t\t<\/table><\/div><\/div>");$("div.enter_w").append(v.join(""));utility.associateSwitch.apply($("#enableAdvPanel"));!function(){var t=[],r="http://static.fishlee.net/resources/audio/",n,i;t.push("<div id='tbSelectMusic' class='box' style='width:500px; display:none;'><table style='width:100%;'>");$.each({"音乐":[["music1","超级玛丽"],["music2","蓝精灵"],["song7","未知铃声(柔)"],["song15","卡农"]],"歌曲":[["song3","the day you went away"],["song5","Zo Verliefd"],["song10","红模仿"],["song13","简单爱"],["song16","Tell me"],["song18","庆祝"],["song19","哇啦哇啦"],["song20","蓝色雨"],["song21","相见恨晚"],["song23","有没有那么一首歌会让你想起我"],["song24","水手"],["song6","笔记"],["song8","放开你的心"]],"歌曲(翻唱)":[["song14","今天我要向你告白韩语版"],["song12","加油"],["song17","情非得已"]],"怀旧":[["song11","葫芦兄弟"],["song22","学习雷锋"]],"搞笑":[["song9","搞笑鸡鸣"],["song25","猪八戒背媳妇"]],"警告提示":[["song2","奔腾四广告"],["song4","警笛"]],"其它":[["song1","未知"],["song","经典风格"]]},function(n,i){t.push("<tr><td class='name' style='width:70px;'>"+n+"<\/td><td>");$.each(i,function(){t.push("<a href='javascript:;' url='"+r+this[0]+".ogg' class='murl'>"+this[1]+"<\/a>&nbsp;&nbsp;&nbsp;&nbsp;")});t.push("<\/td><\/tr>")});t.push("<\/table><\/div>");$("body").append(t.join(""));n=null;i=function(){var t=document.getElementById("txtMusicUrl").value;n?(n.pause(),n.src=t,n.play()):(n=new Audio(t),n.play())};$("a.murl").click(function(){$("#txtMusicUrl").val(this.getAttribute("url")).change();i()});$("#btnTestAudio").click(i);$("#btnSelectPresetAudio").click(function(){$.prompt({title:"选择内置音乐",ele:$("#tbSelectMusic"),to:$(this)})})}();$("#stopBut").before("<div class='jmp_cd' style='text-align:center;'><button class='fish_button' id='btnFilter'>加入黑名单<\/button><button class='fish_button' id='btnAutoBook'>自动预定本车次<\/button><\/div>");$("#txtMusicUrl").change(function(){window.localStorage.audioUrl=this.value});$("form[name=querySingleForm]").attr("id","querySingleForm");tt=window.onStopHover;window.onStopHover=function(n){$("#stopDiv").attr("info",$.trim($("#id_"+n.split("#")[0]).text()));tt.call(this,n);$("#onStopHover").css("overflow","hide")};$("#btnFilter").click(function(){var n=$("#stopDiv").attr("info").split("#")[0];n&&confirm("确定要将车次【"+n+"】加入黑名单？以后的查询将不再显示此车次。")&&list_blacklist.add(n)});$("#btnAutoBook").click(function(){var n=$("#stopDiv").attr("info").split("#")[0];if(rt(n)){alert("指定的车次在黑名单里呢……");return}n&&confirm("确定要将车次【"+n+"】加入自动预定列表？如果下次查询有符合要求的席别将会自动进入预定页面。")&&list_autoorder.add(n)});var et=$("#chkFilterNonBookable")[0],ot=$("#chkFilterNonNeeded")[0],c=!1,y=null;if($(document).bind("ticket.validTicketFound",function(){window.isInAutoRefreshMode()&&(k(),$("#refreshinfo").html("已经有票鸟！"),utility.notify("可以订票了！"),window.Audio&&$("#chkAudioOn")[0].checked&&(f||(f=new Audio($("#txtMusicUrl").val())),f.loop=$("#chkAudioLoop")[0].checked,$("#btnStopSound")[0].disabled=!1,f.play()))}),$("table.obj tr td, #advQueryContainer td").live("checkingTicketSeat",function(n){if(s[n.i-1]){var i=n.e,t=$.trim(i.text());n.result=t=="*"||t=="--"||t=="无"?0:2}else n.result=0;return n.result}),$("table.obj tr, #advQueryContainer tr:gt(0):not(:first)").live("checkTicketRow",function(n){var r=n.trainCode,t=n.row,i;return rt(r)?(t.hide(),n.result=0,n.result):$("a.btn130",t).length>0?(n.result=0,n.result):(i=1,$("td",t).each(function(n,u){if(!(n<4)&&!(n>14)){u=$(u);var f=$.extend(new $.Event("checkTicketSeat"),{i:n,e:u,code:r,tr:t,index:u.index(),seatType:a[u.index()-1]});f.result=null;u.attr("scode",f.seatType);u.trigger(f);f.result==null&&(f.type="checkingTicketSeat",u.trigger(f));!f.result==null&&(u.type="checkedTicketSeat",u.trigger(f));u.attr("result",f.result);f.result==2?(i=2,u.addClass("validCell")):u.addClass("unValidCell")}}),t.attr("result",i),n.result=i,i)}),window.isInAutoRefreshMode=function(){return u.hasClass("fish_button_highlight")||i.hasClass("fish_button_highlight")},$("body").ajaxComplete(function(n,f,e){var h,c,o;if(r==null&&e.url.indexOf("queryLeftTicket")!=-1){t.trigger("checkingTicket");var a=$("table.obj tr:gt(0)"),s=!1,l={};a.each(function(){var n=$(this),u=ct(n),t,i,r;n.attr("tcode",u);n.find("td:eq(0)").click(pt);t=new $.Event("checkTicketRow");t.trainCode=u;t.row=n;i=$.trim(n.find("td:eq(1)").text()).split(/\s+/);t.fromStation=i[0];t.fromTime=i[1];i=$.trim(n.find("td:eq(2)").text()).split(/\s+/);t.toStation=i[0];t.toTime=i[1];n.trigger(t);r=t.result;console.log("[INFO][车票可用性校验] "+u+" 校验结果="+r);r==2?(n.addClass("validRow"),l[u]=n):(n.addClass("unValidRow"),r==1&&ot.checked&&n.hide(),r==0&&et.checked&&n.hide());s=s||r==2});t.trigger("checkedTicket");h=$("table.obj tr:gt(0)");c=h.filter(":visible").length;$("#cx_titleleft span:last").html(c+" ("+(h.length-c)+" 已过滤) ");s?(o=new $.Event("validTicketsFound"),o.rows=l,t.trigger(o),typeof o.result=="undefined"||o.result==null||o.result?(t.trigger("ticket.validTicketFound"),u.hasClass("fish_button_highlight")&&u.click(),i.hasClass("fish_button_highlight")&&i.click()):(t.trigger("noticket"),p())):(t.trigger("noticket"),p())}}),$("#orderForm").submit(function(){parent.$("#orderForm").remove();parent.$("body").append($("#orderForm").clone(!1).attr("target","main").attr("success","0"))}),$("body").ajaxComplete(function(n,t,i){i.url.indexOf("/otsweb/order/querySingleAction.do")!=-1&&t.responseText=="-1"?(invalidQueryButton(),delayButton(),p()):$("#serverMsg").html("")}),$("body").ajaxError(function(n,t,i){i.url.indexOf("queryLeftTicket")!=-1&&i.url.indexOf("/otsweb/order/querySingleAction.do")!=-1&&(delayButton(),p())}),function(){var n=window.sendQueryFunc;window.sendQueryFunc=function(){return $("#fromStationText")[0].disabled||(utility.setPref("_from_station_text",$("#fromStationText").val()),utility.setPref("_from_station_telecode",$("#fromStation").val()),utility.setPref("_to_station_text",$("#toStationText").val()),utility.setPref("_to_station_telecode",$("#toStation").val()),utility.setPref("_depart_date",$("#startdatepicker").val()),utility.setPref("_depart_time",$("#startTime").val())),n.apply(this,arguments)};$("#submitQuery, #stu_submitQuery").unbind("click",n).click(window.sendQueryFunc)}(),!$("#fromStationText")[0].disabled){var it=utility.getPref("_from_station_text"),lt=utility.getPref("_from_station_telecode"),at=utility.getPref("_to_station_text"),vt=utility.getPref("_to_station_telecode"),g=utility.getPref("_depart_date"),yt=utility.getPref("_depart_time");it&&($("#fromStationText").val(it),$("#fromStation").val(lt),$("#toStationText").val(at),$("#toStation").val(vt),e=new Date,e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),console.log(e),console.log(new Date(g)),new Date(g)>=e&&$("#startdatepicker").val(g),$("#startTime").val(yt))}window.Audio||$(".musicFunc").hide(),function(){var n=$("table.cx_from tr:eq(0) td:eq(5), table.cx_from tr:eq(1) td:eq(3)");n.width("170px");n.find("input").width("70px").css({"margin-right":"1px","margin-left":"1px"}).before('<input type="button" style="margin-right:0;" class="date_prev lineButton" value="&lt;">').after('<input style="margin-right:0; style="margin-left:0;"" type="button" class="date_next lineButton" value="&gt;">');n.find(".date_prev").click(function(){var n=$(this).next();n.val(utility.formatDate(utility.addTimeSpan(utility.parseDate(n.val()),0,0,-1,0,0,0))).change()});n.find(".date_next").click(function(){var n=$(this).prev();n.val(utility.formatDate(utility.addTimeSpan(utility.parseDate(n.val()),0,0,1,0,0,0))).change()})}(),function(){var n="<tr class='fish_sep' id='autoChangeDateRow'><td class='name'>自动轮查<\/td><td><label><input type='checkbox' id='autoChangeDate' /> 无票时自动更改日期轮查<\/label><\/td><td><\/td><td><\/td><\/tr><tr class='fish_sep' style='display:none;'><td class='name'>轮查日期设置<\/td><td colspan='3' id='autoChangeDateList'><\/td><\/tr>\t",t,f,u,e;$("#viewHelper").after(n);var i=$("#autoChangeDateList"),n=[],r=new Date;for(t=0;t<20;t++)n.push("<label style='margin-right:16px;'><input type='checkbox' value='"+utility.formatDate(r)+"' cindex='"+t+"' />"+utility.formatDateShort(r)+"<\/label>"),(t+1)%10==0&&n.push("<br />"),r=utility.addTimeSpan(r,0,0,1,0,0,0);i.html(n.join(""));$("#autoChangeDate").change(function(){var n=$(this).closest("tr").next();this.checked?n.show():n.hide()});$("#autoChangeDateRow").initAsOption("autoChangeDateRow");f="autoChangeDateRow_dates";u=window.localStorage.getItem(f);typeof u!="undefined"&&u&&(e=u.split("|"),i.find(":checkbox").each(function(){this.checked=$.inArray(this.value,e)!=-1}));i.find(":checkbox").change(function(){var n=$.map(i.find(":checkbox:checked"),function(n){return n.value}).join("|");window.localStorage.setItem(f,n)})}();t.bind("noticket",function(n){var i,t;if(!n.result&&document.getElementById("autoChangeDate").checked){if(console.log("自动轮询日期中。"),i=$("#autoChangeDateList input.current"),i.removeClass("current"),t=null,i.length){if(t=i.parent().nextAll(":has(:checked):eq(0)").find("input"),t.length?n.result=!0:t=$("#autoChangeDateList :checkbox:checked:eq(0)"),!t.length)return}else{if(t=$("#autoChangeDateList :checkbox:checked:eq(0)"),!t.length)return;n.result=!0}t.addClass("current");$("#startdatepicker").val(t.val())}}),function(){var n=window.alert;window.alert=function(t){t.indexOf("服务器忙")!=-1?$("#serverMsg").text(t):n(t)}}(),function(){function t(){document.getElementById("autoorder").checked&&(r.removeClass("steps stepsok"),r.addClass(list_autoorder.datalist.length?"stepsok":"steps"))}function u(n){var t=prompt("请输入您要加入列表的车次。车次可以使用正则表达式（亲，不知道的话请直接填写车次编号喔），比如 【.*】(不包括【】号) 可以代表所有车次，【K.*】可以代表所有K字头的车次，【D.*】可以代表所有D字头车次等等");if(t){t=t.replace(/(，|,|\/|\\|、|-)/g,"|");try{new RegExp(t)}catch(i){alert("嗯……看起来同学您输入的不是正确的正则表达式哦。");return}n.add(t)}}function f(n){n.emptyList()}function o(){var n=$("#preseatlist input");l&&$(":checkbox[name=seatoption]").attr("checked",!1).change();window.seatLevelOrder=[];n.each(function(){var n=$(this).attr("code");window.seatLevelOrder.push(n);l&&$("#seatoption_"+n).attr("checked",!0).change()});n.length?($("#preseatlist_empty").hide(),window.localStorage.setItem("autoSelect_preSelectSeatType",window.seatLevelOrder[0])):($("#preseatlist_empty").show(),$(":checkbox[name=seatoption]").attr("checked",!0).change(),window.localStorage.setItem("autoSelect_preSelectSeatType",""));l&&utility.notify("已经根据您选择的席别自动切换了席别过滤选项，请注意，并作出需要的调整。");window.localStorage.setItem("preSelectSeatType",window.seatLevelOrder.join("|"));document.getElementById("autoorder").checked&&(e.removeClass("stepsok steps"),e.addClass(window.seatLevelOrder.length?"stepsok":"steps"))}var i="<tr class='fish_sep caption' style='line-height:26px;'><td colspan='2'><label title='加入白名单的车次，将不会被过滤(仅为搭配黑名单)'><input type='checkbox' id='swWhiteList' name='swWhiteList' checked='checked' /> 一定要看到的车次<\/label><div style='float:right;'><button class='fish_button' id='btnAddWhite'>添加<\/button><button class='fish_button' id='btnClearWhite'>清空<\/button><\/div><\/td><td colspan='2'><label title='加入黑名单的车次，除非在白名单中，否则会被直接过滤而不会显示'><input type='checkbox' id='swBlackList' checked='checked' name='swBlackList' />打死你也不想看到的车次<\/label><div style='float:right;'><button class='fish_button' id='btnAddBlack'>添加<\/button><button class='fish_button' id='btnClearBlack'>清空<\/button><\/div><\/td><\/tr><tr class='fish_sep'><td colspan='2' id='whiteListTd'><\/td><td colspan='2' id='blackListTd'><\/td><\/tr>",r,s,n,e,h;$("#viewFilter").after(i);i="<tr class='caption autoorder_steps fish_sep' id='selectPasRow'><td colspan='3' title='加入此列表的乘客将会自动在提交订单的页面中添加上'><span class='hide indicator'>① <\/span>自动添加乘客 （<strong>最多选五位<\/strong>）<\/td><td><input type='button' class='fish_button' onclick=\"self.location='/otsweb/passengerAction.do?method=initAddPassenger&';\" value='添加联系人' /> <input type='button' class='fish_button' id='btnRefreshPas' value='刷新列表' /><\/td><\/tr><tr class='fish_sep'><td class='name'>未选择<\/td><td id='passengerList' colspan='3'><span style='color:gray; font-style:italic;'>联系人列表正在加载中，请稍等...如果长时间无法加载成功，请尝试刷新页面  x_x<\/span><\/td><\/tr><tr class='fish_sep'><td class='name'>已选择<\/td><td id='passengerList1' colspan='3'><\/td><\/tr><tr class='fish_sep autoordertip' style='display:none;'><td class='name'>部分提交订单<\/td><td><label><input type='checkbox' id='autoorder_part' /> 当票数不足时，允许为部分的联系人先提交订单<\/label><\/td><td class='name'>提交为学生票<\/td><td><label><input type='checkbox' id='autoorder_stu' /> 即使是普通查询，也为学生联系人提交学生票<\/label><\/td><\/tr><tr class='fish_sep autoorder_steps caption' id='seatLevelRow'><td><span class='hide indicator'>② <\/span>席别优先选择<\/td><td><input type='hidden' id='preSelectSeat' /><select id='preSelectSeatList'><\/select> （选中添加，点击按钮删除；<a href='http://www.fishlee.net/soft/44/tour.html' style='color:#4c4c4c' target='_blank'>更多帮助<\/a>）<\/td><td style='text-align:right;'><\/td><td><\/td><\/tr><tr class='fish_sep'><td colspan='4' id='preseatlist'><div id='preseatlist_empty' style='padding:5px;border:1px dashed gray;background-color:#fafafa;width:200px;'>(尚未指定，请从上面的下拉框中选定)<\/div><\/td><\/tr><tr class='fish_sep autoorder_steps caption'><td colspan='2'><label><span class='hide indicator'>③<\/span> 自动为我选择车次<\/label><\/td><td style='font-weight:normal;'><select id='autoorder_method'><option value='0'>席别优先<\/option><option value='1'>车次优先<\/option><\/select><\/td><td style='text-align:rigth;'><button id='btnAddAutoBook' class='fish_button'>添加<\/button><button id='btnClearAutoBook' class='fish_button'>清空<\/button><\/td><\/tr><tr class='fish_sep'><td colspan='4' id='autobookListTd'><\/td><\/tr><tr class='fish_sep'><td colspan='4'><div><label title='在通常情况下，排除黑名单和不需要的席别后，只要可以订车次了，助手就会提示你有票。如果你开启此选项，那么只有当按照你预定的自动选择车次和席别设置可以找到车次时，才会提示你有票。此模式适合于你只需要部分车次或指定车次，但是你依然想看到其它车次或席别的余票情况。'><input type='checkbox' id='swOnlyValid' name='swOnlyValid' /> 如果没有找到符合我要求的票，则继续刷票而不提示有票<\/label><\/div><div><label title='如果开启此选项，当按照你选择的车次和席别找到指定的可定票时，助手会自动跳转到订票界面。'><input type='checkbox' id='swAutoBook' checked='checked' name='swAutoBook' /> <span class='hide indicator'>④<\/span> 当找到符合要求的车次和席别时，自动转到预定界面<\/label><\/div><div><label><input type='checkbox' id='autoBookTip' name='autoBookTip' checked='checked' /> 如果自动预定成功，进入预定页面后播放提示音乐并弹窗提示<\/label><\/div><\/td><\/tr><tr class='fish_sep autoordertip' style='display:none;'><td class='name'>自动回滚<\/td><td><label title='当系统繁忙时，提交订单的请求可能会出错（如超时等），此时会需要你重新查询并重新预定。开启此选项时，一旦页面出错，助手将会自动为您重新提交预定，省去重新查询的过程。'><input type='checkbox' id='autoorder_autocancel' /> 自动提交失败时，自动取消自动提交并再次预定<\/label><\/td><\/tr><tr class='caption autoorder_steps fish_sep highlightrow'><td class='name autoordertd'><label style='display:none;color:red;'><input type='checkbox' id='autoorder'/>自动提交订单<\/label><\/td><td class='autoordertd' colspan='3'><p style='display:none;'><!--img id='randCode' src='/otsweb/passCodeAction.do?rand=randp' /--> <input size='4' maxlength='4' type='text' id='randCodeTxt' /> (验证码可在放票前填写，临近放票时建议点击图片刷新并重新填写，以策安全。请务必控制好阁下的眼神……)<\/p><\/td><\/tr><tr style='display:none;' class='autoordertip fish_sep'><td class='name' style='color:red;'>警告<\/td><td colspan='3' style='color:darkblue;'><p style='font-weight:bold; color:purple;'>自动提交订单使用流程：勾选要订票的联系人 -&gt; 设置需要的席别 -&gt; 将你需要订票的车次按优先级别加入自动预定列表 -&gt; 勾选自动提交订单 -&gt; 输入验证码 -&gt; 开始查票。信息填写不完整将会导致助手忽略自动提交订单，请务必注意。进入自动订票模式后，席别选择和自动预定都将被锁定而无法手动切换。如果查询的是学生票，那么提交的将会是学生票订单。<u style='color:red;'>一切都设置完成后，请点击查询开始查票。一旦有票将会自动提交。<\/u><\/p><p>1. 自动提交订单使用的是自动预定的列表顺序，取第一个有效的车次自动提交订单！请确认设置正确！！<\/p><p>2. 自动提交的席别和联系人请在上方选择，和预设的是一致的，暂不支持不同的联系人选择不同的席别；<\/p><p>3. 作者无法保证自动提交是否会因为铁老大的修改失效，因此请务必同时使用<b>其它浏览器<\/b>手动提交订单！否则可能会造成您不必要的损失！<\/p><p style='font-weight:bold;'>5. 当助手第一次因为功能性自动提交失败后（非网络错误和验证码错误，如余票不足、占座失败等），将会立刻禁用自动提交并回滚到普通提交，并再次提交订票请求，因此请时刻注意提交结果并及时填写内容，并强烈建议你另外打开单独的浏览器同时手动下订单！！<\/p><p style='font-weight:bold;color:darkcylan;'>6. 为可靠起见，建议每隔一段时间刷新下验证码重新填写（点击验证码图片刷新）。由于不同的浏览器刷新的结果不一样，强烈建议多个浏览器或多台机子一起刷新！<\/p><p style='font-size:16px; font-weight:bold;color:blue;'>一定要仔细看说明啊！切记多个浏览器准备不要老想着一棵树上吊死啊！千万不要因为自动提交订单导致你订不到票啊！！这样老衲会内疚的啊！！！！<\/p><\/td><\/tr>";$("#autoFill").after(i);$("#btnRefreshPas").click(function(){window.localStorage.removeItem("pas");alert("请进入我的12306->常用联系人并稍等片刻以更新缓存 -.-")}).hide();$("#autoorder_method").val(window.localStorage.autoorder_method||"0").change(function(){window.localStorage.setItem("autoorder_method",$(this).val())});$("#autoorder_autocancel").attr("checked",(window.localStorage.autoorder_autocancel||"1")=="1").change(function(){window.localStorage.setItem("autoorder_autocancel",this.checked?"1":"0")});list_autoorder=utility.selectionArea.call($("#autobookListTd"),{syncToStorageKey:"list_autoBookList",onAdd:t,onRemove:t,onClear:t});list_blacklist=utility.selectionArea.call($("#blackListTd"),{syncToStorageKey:"list_blackList"});list_whitelist=utility.selectionArea.call($("#whiteListTd"),{syncToStorageKey:"list_whiteList"});r=$("#swAutoBook").closest("tr");$("#btnAddAutoBook").click(function(){u(list_autoorder)});$("#btnAddWhite").click(function(){u(list_whitelist)});$("#btnAddBlack").click(function(){u(list_blacklist)});$("#btnClearAutoBook").click(function(){f(list_autoorder)});$("#btnClearWhite").click(function(){f(list_whitelist)});$("#btnClearBlack").click(function(){f(list_blacklist)});$("#swBlackList, #swAutoBook, #swOnlyValid, #swWhiteList, #autoBookTip").initAsOption();s=[["","=请选择="],["9","商务座"],["P","特等座"],["6","高级软卧"],["4","软卧"],["3","硬卧"],["2","软座"],["1","硬座"],["empty","硬座(无座)"],["M","一等座"],["O","二等座"]];n=document.getElementById("preSelectSeatList");$.each(s,function(){n.options[n.options.length]=new Option(this[1],this[0])});e=$("#seatLevelRow");$("#preSelectSeatList").change(function(){var t=n.selectedIndex,i,r;t!=0&&(i=n.options[t],r="<input type='button' title='点击删除' class='seatTypeButton lineButton' value='"+i.text+"' code='"+i.value+"' />",$("#preseatlist").append(r),$("#preseatlist_empty").hide(),n.options[t]=null,n.selectedIndex=0,o())});$("input.seatTypeButton").live("click",function(){var t=$(this),i,r;t.remove();i=t.attr("code");r=t.val();n.options[n.options.length]=new Option(r,i);o()}),function(){var t=window.localStorage.getItem("preSelectSeatType")||window.localStorage.getItem("autoSelect_preSelectSeatType"),i;t&&(t=t.split("|"),i=$(n),$.each(t,function(){i.val(this+"");i.change()}))}();$("#autoorder").click(function(){this.checked&&(h=document.getElementById("swAutoBook").checked,document.getElementById("swAutoBook").checked=!0);document.getElementById("swAutoBook").disabled=this.checked;this.checked?($(".autoordertip").show(),$(":checkbox[name=seatoption]").attr("disabled",!0),o(),t()):($(".autoordertip").hide(),document.getElementById("swAutoBook").checked=h,$(":checkbox[name=seatoption]").attr("disabled",!1),$("tr.autoorder_steps").removeClass("steps").removeClass("stepsok"))});utility.isfeatureDisabled("pasload")?$("#passengerList").html("<strong>警告<\/strong>：介个联系人加载功能已被自动禁用，为了保证您的安全……如果要重新启用，请 <button class='lineButton resetFuncFlag' data-function='pasload'>尝试重新启用联系人加载<\/button>。"):($("#passengerList").html("<strong>提示<\/strong>：联系人准备加载中，请稍等（约延迟不超过10秒）。"),setTimeout(function(){utility.getAllPassengers(function(n){function r(n){if(document.getElementById("autoorder").checked){var t=$("#selectPasRow");t.removeClass("steps stepsok");t.addClass(n.length?"stepsok":"steps")}}var t=[],i=(localStorage.getItem("preSelectPassenger")||"").split("|"),u=0;$.each(n,function(){var n=this.passenger_name+this.passenger_id_type_code+this.passenger_id_no;this.index=u++;t.push("<label style='margin-right:10px;'><input type='checkbox' id='preSelectPassenger"+this.index+"' name='preSelectPassenger'"+($.inArray(n,i)>-1?" checked='checked'":"")+" value='"+n+"' />"+this.passenger_name+"<\/label>")});$("#passengerList").html(t.join("")).find("input").change(function(){var i=$(this).closest("label"),n,t;if(this.checked){if(n=$("#passengerList1 :checkbox"),n.length>=5){alert("选择的乘客不能多于五位喔~~");this.checked=!1;return}$("#passengerList1").append(i)}else $("#passengerList").append(i);n=$("#passengerList1 :checkbox");t=$.map(n,function(n){return n.value});$("#ticketLimition").val(n.length);localStorage.setItem("preSelectPassenger",t.join("|"));r(t)});$.each(i,function(){$("#passengerList :checkbox[value="+this+"]").change()});$.each(n,function(){$("#preSelectPassenger"+this.index).data("pasinfo",this)});$("#ticketLimition").val($("#passengerList1 :checkbox").length);$("#autoorder").click(function(){r($("#passengerList1 :checkbox"))})})},1e4))}(),function(){var t=[],i,n;for(t.push("<tr class='fish_sep'><td title='介个就是说……如果票票数小于这里的数字的话……就无视的啦 =。='><strong>最少要票<\/strong><td colspan='3'><select id='ticketLimition'><\/select> 张"),t.push("<\/td><\/tr>"),$("#viewFilter").after(t.join("")),i=$("#ticketLimition").val($("#passengerList1 :checkbox").length)[0],n=0;n<6;n++)i.options[n]=new Option(n?n:"(无限制)",n);$("table.obj tr td").live("checkingTicketSeat",function(n){var r=parseInt(i.value),t;return!n.result||!(r>0)||$("#autoorder_part:visible:checked").length?0:(t=$.trim(n.e.text()),t=="有")?2:(n.result=parseInt(t)>=r?2:1,n.result)})}(),function(){var n=$("input:checkbox[name=trainClassArr]"),t=(utility.getPref("cctype")||"").split("|");t[0]&&n.each(function(){this.checked=$.inArray(this.value,t)!=-1});n.click(function(){utility.setPref("cctype",$.map(n.filter(":checked"),function(n){return n.value}).join("|"))})}(),function(){var t=$("#fromStation"),n=$("#fromStationText"),i=$("#toStation"),r=$("#toStationText");n.css("width","60px").after("<input style='margin-right:0;' type='button' value='<>' class='lineButton' title='交换出发地和目的地' id='btnExchangeStation' />");$("#toStationText");$("#btnExchangeStation").click(function(){var u=t.val(),f=n.val();t.val(i.val());n.val(r.val());i.val(u);r.val(f)})}(),function(){var n=$("#fromStationText"),t=$("#toStationText");$("#filterFunctionRow").append("<li><label style='font-weight:bold;color:#ff2020;'><input type='checkbox' id='closeFuseSearch'>过滤发站不完全匹配的车次<\/label><\/li><li><label style='font-weight:bold;color:#ff2020;'><input type='checkbox' id='closeFuseSearch1'>过滤到站不完全匹配的车次<\/label><\/li>");$("#closeFuseSearch, #closeFuseSearch1").parent().attr("title","默认情况下，例如查找‘杭州’时，会包括‘杭州南’这个车站。勾选此选项，将会在搜索‘杭州’的时候，过滤那些不完全一致的车站，如‘杭州南’。");$("table.obj tr").live("checkTicketRow",function(i){return document.getElementById("closeFuseSearch").checked&&i.fromStation!=n.val()?(i.row.hide(),i.result=0,!1):document.getElementById("closeFuseSearch1").checked&&i.toStation!=t.val()?(i.row.hide(),i.result=0,!1):!0})}();h=null;n=null,function(){function n(){var n=null;utility.get("/otsweb/main.jsp",null,"text",function(t,i,r){n=new Date(r.getResponseHeader("Date"));h=new Date-n},null,"","https://dynamic.12306.cn/otsweb/")}setTimeout(n,5e3);setInterval(n,6e5)}(),function(){function i(){if(h!==null){var i=new Date;n=new Date;n.setTime(i.getTime()-h);$("#chkSmartSpeed, .needServerTime").attr("disabled",n.getFullYear()<2e3);t.eq(0).html(utility.formatTime(n));t.eq(1).html(utility.formatTime(i));t.eq(2).html((h<0?"快":"慢")+Math.abs(h)/1e3+"秒")}}var t=$("#servertime strong");setInterval(i,1e3);i()}(),function(){function e(n){return utility.parseJSON(window.localStorage.getItem("profile_"+n))}function r(n,t){t?window.localStorage.setItem("profile_"+n,utility.toJSON(t)):window.localStorage.removeItem(n)}function u(){var n={};return n.blackListEnabled=document.getElementById("swBlackList").checked,n.whiteListEnabled=document.getElementById("swWhiteList").checked,n.autoBookListEnabled=document.getElementById("swAutoBook").checked,n.seatOrder=window.seatLevelOrder||[],n.prePassenger=$.map($("#passengerList1 :checkbox"),function(n){var t=$(n).data("pasinfo");return{type:t.passenger_type,idtype:t.passenger_id_type_code,id:t.passenger_id_no}}),n.whiteList=list_whitelist.datalist,n.blackList=list_blacklist.datalist,n.autoBookList=list_autoorder.datalist,n.autoBookMethod=$("#autoorder_method").val(),n.queryInfo=$("#querySingleForm").serializeArray(),n}function f(n){var i,t;$("#swBlackList").attr("checked",n.blackListEnabled).change();$("#swWhiteList").attr("checked",n.whiteListEnabled).change();$("#swAutoBook").attr("checked",n.autoBookListEnabled).change();$("#preseatlist input").click();i=$("#preSelectSeatList");n.seatOrder&&$.each(n.seatOrder,function(){i.val(this+"").change()});list_whitelist.emptyList();$.each(n.whiteList,function(){list_whitelist.add(this+"")});list_blacklist.emptyList();$.each(n.blackList,function(){list_blacklist.add(this+"")});list_autoorder.emptyList();$.each(n.autoBookList,function(){list_autoorder.add(this+"")});t=$("input:checkbox[name=preSelectPassenger]");t.attr("checked",!1);t.change();$.each(n.prePassenger,function(){var n=this;t.each(function(){var t=$(this).data("pasinfo");return t.passenger_type==n.type&&t.passenger_id_type_code==n.idtype&&t.passenger_id_no==n.id?(this.checked=!0,$(this).change(),!1):!0})});$("#autoorder_method").val(n.autoBookMethod).change();n.queryInfo&&$.each(n.queryInfo,function(){this.name.indexOf("orderRequest.")!=-1&&$("input[name="+this.name+"]").val(this.value).change()});utility.notify("已加载出行模式")}$("#helpertooltable tr:first").before("<tr class='fish_sep fish_area'><td colspan='4' title='出行模式可以帮你快速的保存一系列设置，如联系人、车次、席别、黑名单和白名单'>出行模式<\/td><\/tr><tr class='fish_sep'><td colspan='4'><select id='profilelist'><option value=''>==选择一个出行模式==<\/option><\/select><button id='profile_save' class='fish_button'>保存<\/button><button id='profile_add' class='fish_button'>另存<\/button><button id='profile_delete' class='fish_button'>删除<\/button><button id='profile_reset' class='fish_button'>重置所有选项<\/button><\/td><\/td><\/tr>");var n=(window.localStorage.profilelist||"").split("\t"),t=$("#profilelist"),i=t[0];n[0]==""&&n.splice(0,1);$.each(n,function(){i.options[i.options.length]=new Option(this+"",this+"")});t.change(function(){var n=t.val();n&&f(e(n))});$("#profile_save").click(function(){t.val()?(r(t.val(),u()),alert("存档已经更新~")):$("#profile_add").click()});$("#profile_add").click(function(){var f=u(),t=prompt("请输入出行模式的名称，如『出去鬼混』神马的……","嗷嗷回家~");t&&(t=t.replace(/\s+/g,""),window.localStorage.getItem("profile_"+t)?alert("啊嘞？这个名字的已经有了喔，重试呗~"):(r(t,f),n.push(t),i.options[i.options.length]=new Option(t,t),window.localStorage.setItem("profilelist",n.join("\t")),alert("已保存唷。")))});$("#profile_delete").click(function(){var t=i.selectedIndex;t&&confirm("亲，确定要下此狠手咩？")&&(i.options[t]=null,window.localStorage.removeItem("profile_"+n[t-1]),n.splice(t-1,1),window.localStorage.setItem("profilelist",n.join("\t")),alert("乃伊佐特~"))});$("#profile_reset").click(function(){t.val("");f({blackListEnabled:!0,whiteListEnabled:!0,autoBookListEnabled:!0,seatOrder:[],prePassenger:[],whiteList:[],blackList:[],autoBookList:[],autoBookMethod:"1"})})}(),function(){var t=null,n=$(".cx_titler");$(document).ajaxComplete(function(i,r,u){var e,s;if(u.url.indexOf("method=queryLeftTicket")!=-1&&r.responseText!="-1"){var h=r.getResponseHeader("Age"),c=r.getResponseHeader("X-Cache")||"",f=r.getResponseHeader("Date")||"<未知>",o="<未知>";f&&(f=new Date(f),o=utility.formatTime(f));e=h==1||f==t||c.indexOf("HIT")!=-1;s="数据时间："+o;n.html((e?"这可能是缓存的说……整点请使用『等待整点』。。。":"")+s);e?n.addClass("warning"):n.removeClass("warning")}})}(),function(){function n(){var n=$("table.obj tr[result]:visible");n.each(function(){var n=$(this),t,i;if(n.attr("result")==0)return!0;t=n.find(orderButtonClass)[0].onclick+"";i=utility.getTicketInfo(t);$.each(i,function(t,i){var r=n.find("td[scode="+t+"]");$.trim(r.text())=="有"&&r.html(i)})})}$(document).bind("checkedTicket",n)}(),function(){var n=[],i=$("input[name=trainClassArr]"),r;n.push("<tr class='fish_sep' id='trAutoChangeClass'><td class='name'><label title='选择肯定不要的列车类型，每次查询后小的会随机更改查询条件，好查得更及时~'><input type='checkbox' name='autoChangeTrainClass' id='autoChangeTrainClass' /> 更改列车类型<\/label><\/td><td colspan='3'>");i.each(function(){this.value!="QB"&&n.push("<label style='margin-right:10px;'><input type='checkbox' id='unwantClass_"+this.value+"' name='unwantClass' value='"+this.value+"' /> "+$(this).parent().text()+"<\/label>")});n.push("<\/td><\/tr>");$("#viewHelper").nextUntil(".fish_area").last().after(n.join(""));$("#trAutoChangeClass input,#trAutoChangeClass select").initAsOption();r=$("#trAutoChangeClass :checkbox[name=unwantClass]");t.bind("checkedTicket",function(){var n,t;if(document.getElementById("autoChangeTrainClass").checked)for(i[0].checked=!1,n=0;n<r.length;n++)t=r[n],i[n+1].checked=t.checked?Math.random()>=.5:!0})}(),function(){window.SetISPos=function(n){var t=n.offset();$("#form_cities, #form_cities2").css({left:t.left,top:t.top+n.height()+3})};return}();$("tr.append_row input, tr.append_row select").initAsOption("ticket_query");l=!0}function initAutoPreSubmitOrder(){$(document).bind("validTicketsFound",function(n){function e(t){return document.getElementById("swAutoBook").checked?(n.result=!1,window.localStorage.bookTip=document.getElementById("autoBookTip").checked?1:0,t.find(orderButtonClass).click(),!1):(n.result=!0,!0)}var f,t,r,h,c,i,o,u;if(typeof window.seatLevelOrder!="undefined"&&window.seatLevelOrder.length&&typeof window.list_autoorder!="undefined"&&window.list_autoorder.datalist.length&&(n.result==null||n.result)&&(document.getElementById("swAutoBook").checked||document.getElementById("swOnlyValid").checked))if(console.log("[INFO] 正在按照预定的席别和车次优选"),document.getElementById("swOnlyValid").checked&&(n.result=!1),window.seatLevelOrder&&window.seatLevelOrder.length){console.log("按席别优先选择-车次过滤");f=$.makeArray($("#gridbox tr[result=2]"));t=[];for(r in list_autoorder.datalist)for(h=list_autoorder.datalist[r],c=utility.getRegCache(h),i=f.length-1;i>=0;i--)o=$(f[i]),u=o.attr("tcode"),c.test(u)&&(t.push(o),f.splice(i,1));document.getElementById("autoorder_method").selectedIndex==0?$.each(window.seatLevelOrder,function(){var r=this,u,n,i;for(u in t)if(n=t[u],n.find("td[scode="+this+"][result=2]").length)return ticketValid=!0,i=r=="empty"?"1":r,window.localStorage.setItem("autoSelect_preSelectSeatType",i),$("#preSelectSeat").val(i),e(n);return!0}):$.each(t,function(){var i=this,r,n,t;for(r in window.seatLevelOrder)if(n=window.seatLevelOrder[r],i.find("td[scode="+n+"][result=2]").length)return ticketValid=!0,t=n=="empty"?"1":n,window.localStorage.setItem("autoSelect_preSelectSeatType",t),$("#preSelectSeat").val(t),e(i);return!0})}else for(r in list_autoorder.datalist){var u=list_autoorder.datalist[r],l=utility.getRegCache(u),s=$.first(validRows,function(n,t){if(l.test(n))return t});if(s)return e(s)}});console.log("[INFO] 席别和车次优选初始化完成")}function dgFilterQuery(){(function(){var t=$("input:checkbox[name=trainClassArr][value=D]"),n=$("input:checkbox[name=trainClassArr][value=QB]"),i=$("input:checkbox[name=trainClassArr][value!=QB][value!=D]");t.closest("li").hide().after("<li><label title='助手添加的动车过滤框，不包含高铁~'><input checked='checked' type='checkbox' name='advDgFilter' id='advDgFilterD' />动车<\/label><\/li><li><label title='助手添加的动车过滤框，不包含动车~'><input type='checkbox' checked='checked' name='advDgFilter' id='advDgFilterG' />高铁<\/label><\/li><li><label title='助手添加的城铁过滤框'><input checked='checked' type='checkbox' name='advDgFilter' id='advDgFilterC' />城铁<\/label><\/li>").closest("div").css("width","50%");var r=document.getElementById("advDgFilterD"),u=document.getElementById("advDgFilterG"),f=document.getElementById("advDgFilterC"),e=$("input:checkbox[name=advDgFilter]");i.add(t).change(function(){var t=f.checked&&r.checked&&u.checked&&i.filter(":not(:checked)").length==0;t!=n[0].checked&&(n[0].checked=t,n.change())});n.click(function(){this.checked?i.add(e).filter(":not(:checked)").attr("checked",!0).change():i.add(e).filter(":checked").attr("checked",!1).change()});$("#advDgFilterD, #advDgFilterG, #advDgFilterC").initAsOption().change(function(){t[0].checked=r.checked||u.checked||f.checked;t.change()}).parent();n.click(function(){r.checked=u.checked=f.checked=this.checked});$("table.obj tr").live("checkTicketRow",function(n){if(!r.checked&&n.trainCode[0]=="D"||!u.checked&&n.trainCode[0]=="G"||!f.checked&&n.trainCode[0]=="C")return n.row.hide(),n.result=0,0})})(),function(){var n,t;$("#viewFilter").nextUntil(".fish_area").last().after('<tr class="fish_sep" id="timeFilter"><td class="name"><label><input type="checkbox" id="swEnableFromFilter" checked="checked"/>出发时间筛选<\/label<\/td><td><select id="timeFilterFrom1"><\/select> 至 <select id="timeFilterFrom2"><\/select><\/td><td class="name"><label><input type="checkbox" id="swEnableToFilter" checked="checked"/>到达时间筛选<\/label><\/td><td><select id="timeFilterTo1"><\/select> 至 <select id="timeFilterTo2"><\/select><\/td><\/tr>');var u=document.getElementById("timeFilterFrom1"),i=document.getElementById("timeFilterFrom2"),f=document.getElementById("timeFilterTo1"),r=document.getElementById("timeFilterTo2"),e=document.getElementById("swEnableFromFilter"),o=document.getElementById("swEnableToFilter");for(n=0;n<25;n++)t=(n<10?"0":"")+n+":00",u.options[n]=new Option(t,n+1),i.options[n]=new Option(t,n+1),f.options[n]=new Option(t,n+1),r.options[n]=new Option(t,n+1);r.selectedIndex=i.selectedIndex=24;$("#timeFilter, #timeFilterFrom1, #timeFilterFrom2, #timeFilterTo1, #timeFilterTo2, #swEnableFromFilter, #swEnableToFilter").initAsOption();$("table.obj tr").live("checkTicketRow",function(n){var t=parseInt(n.fromTime.split(":")[0]),s=parseInt(n.toTime.split(":")[0]);if(e.checked&&(t<u.selectedIndex||t>=i.selectedIndex)||o.checked&&(s<f.selectedIndex||s>=r.selectedIndex))return n.row.hide(),n.result=0,0})}(),function(){$("table.obj tr").live("checkTicketRow",function(n){var t=n.row.find("td:eq(1), td:eq(2)");t.each(function(){var n=$(this),t=(/<img[^>]+>(\s|&nbsp;)?/i.exec(n.html())||[])[0]||"";n.html(t+$.trim(n.text()).split(/\s+/).join("<br />"))})})}(),function(){mygrid.setColWidth(0,60);mygrid.setColWidth(1,70);mygrid.setColWidth(2,70);for(var n=4;n<15;n++)mygrid.setColWidth(n,50)}(),function(){var n=$("div.objbox"),i=n.find(">div"),t=$("#gridbox");$(document).bind("checkedTicket",function(){if(utility.getPref("query.autoexpand")=="1"){var r=Math.max(Math.min(i.height(),650),300)+10;n.css("height",r+"px");t.css("height",r+50+"px")}else n.css("height","300px"),t.css("height","350px")})}()}function initDirectSubmitOrder(){function i(n,t){u.removeClass().addClass(n?"fish_running":"fish_clock").html(t||(n?"正在操作中……":"等待中……"))}function r(n){a.eq(2).find("span").html(utility.getTimeInfo());a.eq(1).find("span").html(n)}function k(){f||(f=!0,v.animate({bottom:"0px"}))}function e(){f&&(f=!1,v.animate({bottom:"-100px"}))}function d(){y.removeClass("steps stepsok");y.addClass(o().length==4?"stepsok":"steps")}function p(){$("#randCode").attr("src","/otsweb/passCodeAction.do?rand=randp&"+Math.random());var n=document.getElementById("randCodeTxt");n.focus();n.select()}function o(){return document.getElementById("randCodeTxt").value}function w(){if(!document.getElementById("autoorder").checked)return[];var n=[];return $("#passengerList1 :checkbox").length||n.push("选择乘客"),$("#preseatlist input").length||n.push("设置优选席别"),o().length!=4&&n.push("填写验证码"),$("#autobookListTd input").length||n.push("设置自动预定车次"),n}function h(){window.location.replace("/otsweb/order/myOrderAction.do?method=queryMyOrderNotComplete&leftmenu=Y")}function g(i){var r;if(typeof i!="undefined"&&i){t=utility.analyzeForm(i);t.fields["orderRequest.reserve_flag"]="A";s=t.tourFlag;n=[];$.each(t.fields,function(t){(t.indexOf("orderRequest")!=-1||t.indexOf("org.")==0||t=="leftTicketStr")&&n.push(t+"="+encodeURIComponent(this))});n.push("tFlag="+t.tourFlag);var l=$("#passengerList1 :checkbox"),a=$("#preSelectSeat").val(),v=0;for(r=0;r<5;r++){if(r>=l.length){n.push("oldPassengers=");n.push("checkbox9=");continue}var u=l.eq(r).data("pasinfo"),f=u.passenger_type,e=u.passenger_id_type_code,o=u.passenger_id_no,h=u.passenger_name;clickBuyStudentTicket=="Y"||f!="3"||document.getElementById("autoorder_stu").checked||(f=1);n.push("passengerTickets="+a+","+v+","+f+","+encodeURIComponent(h)+","+e+","+encodeURIComponent(o)+","+u.mobile_no+",Y");n.push("oldPassengers="+encodeURIComponent(h)+","+e+","+encodeURIComponent(o));n.push("passenger_"+(r+1)+"_seat="+a);n.push("passenger_"+(r+1)+"_seat_detail="+v);n.push("passenger_"+(r+1)+"_ticket="+f);n.push("passenger_"+(r+1)+"_name="+encodeURIComponent(h));n.push("passenger_"+(r+1)+"_cardtype="+e);n.push("passenger_"+(r+1)+"_cardno="+o);n.push("passenger_"+(r+1)+"_mobileno="+u.mobile_no);n.push("checkbox9=Y")}}c()}function c(){i(!0,"正在检测订单状态....");utility.notify("开始自动提交订单！");console.log(t);utility.post("confirmPassengerAction.do?method=checkOrderInfo&rand="+o(),n.join("&")+"&randCode="+o(),"json",function(n){if(console.log(n),"Y"!=n.errMsg||"N"==n.checkHuimd||"N"==n.check608){n.errMsg&&n.errMsg.indexOf("验证码")!=-1?(utility.notify("验证码不正确。请输入验证码！"),r("请重新输入验证码。"),p()):(i(!1,n.msg||n.errMsg),document.getElementById("autoorder").checked=!1,$("#orderForm").submit());return}l()},function(){i(!1,"网络出现错误，稍等重试");utility.delayInvoke(u,c,500)})}function l(){if(!document.getElementById("autoorder").checked){e();return}i(!0,"正在提交订单");r("正在检查队列。");var n={train_date:t.fields["orderRequest.train_date"],station:t.fields["orderRequest.station_train_code"],train_no:t.fields["orderRequest.train_no"],seat:$("#preSelectSeat").val(),from:t.fields["orderRequest.from_station_telecode"],to:t.fields["orderRequest.to_station_telecode"],ticket:t.fields.leftTicketStr};utility.get("/otsweb/order/confirmPassengerAction.do?method=getQueueCount",n,"json",function(n){n.op_2?(r("抽奖人数过多 (人数="+n.count+")"),i(!0,"抽奖人数过多"),utility.delayInvoke(u,l,500)):b()},function(){utility.delayInvoke(u,l,500)})}function b(){if(!document.getElementById("autoorder").checked){e();return}i(!0,"正在提交订单");r("已检测状态。");var t="confirmSingleForQueueOrder";s=="wc"?t="confirmPassengerInfoGoForQueue":s=="fc"?t="confirmPassengerInfoBackForQueue":s=="gc"&&(t="confirmPassengerInfoResignForQueue");utility.post("/otsweb/order/confirmPassengerAction.do?method="+t,n.join("&")+"&randCode="+o(),"json",function(n){var t=n.errMsg;if(t=="Y")r("订单提交成功"),i(!1,"彩票提交成功，请等待开奖。"),utility.notify("彩票提交成功，请等待开奖。"),h();else{if(t.indexOf("包含未付款订单")!=-1){e();alert("您有未支付订单! 等啥呢, 赶紧点确定支付去.");h();return}if(t.indexOf("重复提交")!=-1){r("TOKEN失效，刷新Token中....");$("#orderForm").submit();return}if(t.indexOf("包含排队中")!=-1){e();alert("您有排队中订单! 点确定转到排队页面");h();return}if(t.indexOf("排队人数现已超过余票数")!=-1){document.getElementById("autoorder").checked=!1;r(t);p();i(!1,"警告："+t+"，自动回滚为手动提交，请切换车次或席别，请尽快重试！");sendQueryFunc.call(clickBuyStudentTicket=="Y"?document.getElementById("stu_submitQuery"):document.getElementById("submitQuery"));return}r(t);i(!1,"未知错误："+t+"，请告知作者。");utility.notify("未知错误："+t+"，请告知作者。");document.getElementById("autoorder_autocancel").checked&&(document.getElementById("autoorder").checked=!1,$("#autoorder").change(),$("#orderForm").submit())}},function(){i(!1,"网络出现错误，稍等重试");utility.delayInvoke(u,b,2e3)})}var f,y;return;var a,u,v,n,s,t}function initLogin(){function u(n,t){var i=$("#countEle");i.removeClass().addClass(n?"fish_running":"fish_clock").html(t||(n?"正在操作中……":"等待中……"))}function t(n){p.eq(2).find("span").html(utility.getTimeInfo());p.eq(1).find("span").html(n)}function i(){u(!0,"正在抽摇摇乐……");$.ajax({url:"/otsweb/loginAction.do?method=loginAysnSuggest",method:"GET",dataType:"json",success:function(n,r,f){if(f.getResponseHeader("Set-Cookie")){t("会话被强行结束，请重试");u(!1,"请重新登录");e();return}n.randError!="Y"?utility.delayInvoke("#countEle",i,utility.getLoginRetryTime()):(t("登录幸运数字 - "+n.loginRand),$("#loginRand").val(n.loginRand),b())},error:function(n){f++;n.status==403?(t("["+f+"] 警告! 403错误, IP已被封!"),utility.delayInvoke("#countEle",i,1e4)):(t("["+f+"] 网络请求错误，重试"),utility.delayInvoke("#countEle",i,utility.getLoginRetryTime()))}})}function b(){var n={},r;($.each($("#loginForm").serializeArray(),function(){(this.name!="refundFlag"||document.getElementById("refundFlag").checked)&&(n[this.name]=this.value)}),n["loginUser.user_name"]&&n["user.password"]&&n.randCode&&n.randCode.length==4)&&(utility.setPref("__un",n["loginUser.user_name"]),$("#keepInfo")[0].checked&&utility.setPref("__up",n["user.password"]),r=$.extend(new $.Event("userlogin"),{user:n}),$(document).trigger(r),u(!0,"正在登录中……"),$.ajax({type:"POST",url:"/otsweb/loginAction.do?method=login",data:n,timeout:1e4,dataType:"text",success:function(n,r,f){if(msg=utility.getErrorMsg(n),f.getResponseHeader("Set-Cookie")){t("会话被强行结束，请重试");u(!1,"请重新登录");e();return}if(n.indexOf("请输入正确的验证码")>-1)t("验证码不正确"),u(!1,"请重新输入验证码。"),e();else if(msg.indexOf("密码")>-1||msg.indexOf("登录名")>-1||msg.indexOf("邮箱")!=-1)t(msg),u(!1,"请重新输入。"),e();else if(msg.indexOf("锁定")>-1)t(msg),u(!1,"请重新输入。"),e();else if(n.indexOf("欢迎您登录")!=-1){utility.notify("登录成功，开始查询车票吧！");var o=parent.document.getElementById("loginsubmit");o==null&&(parent.$("body").append("<form action='/otsweb/order/querySingleAction.do' target='main' method='get' id='loginsubmit'><input type='hidden' name='method' value='init' /><\/form>"),o=parent.document.getElementById("loginsubmit"));setTimeout(function(){o.submit()},2e3)}else t(msg),utility.delayInvoke("#countEle",i,utility.getLoginRetryTime())},error:function(n){f++;n.status==403?(t("["+f+"] 警告! 403错误, IP已被封!"),utility.delayInvoke("#countEle",i,1e4)):(t("["+f+"] 网络请求错误，重试"),utility.delayInvoke("#countEle",i,utility.getLoginRetryTime()))}}))}function k(){if(!l){var n=$("#UserName").val();if(n){if(utility.regInfo.bindAcc&&utility.regInfo.bindAcc.length&&utility.regInfo.bindAcc[0]&&$.inArray(n,utility.regInfo.bindAcc)==-1&&utility.regInfo.bindAcc[0]!="*"){alert("很抱歉，12306订票助手的授权许可已绑定至【"+utility.regInfo.bindAcc.join()+"】，未授权用户，助手停止运行，请手动操作。\n您可以在登录页面下方的帮助区点击【重新注册】来修改绑定。");return}w++;utility.setPref("_sessionuser",$("#UserName").val());l=!0;i()}}}function e(){$("#img_rrand_code").click();$("#randCode").val("")[0].select();l=!1}function o(n){return new Date(this.getFullYear(),this.getMonth(),this.getDate()+n)}var s,h,r,c,y,a,v,n;utility.checkCompatible();s=utility.getTopWindow();s.utility.allPassengers&&(s.utility.allPassengers=null);utility.unsafeCallback(function(){if(parent&&parent.$){var n=parent.$("#username_ a").attr("href");n&&n.indexOf("sysuser/user_info")!=-1&&(window.location.href="https://dynamic.12306.cn/otsweb/order/querySingleAction.do?method=init");return}});h=!1;try{h=(top.location+"").indexOf("dynamic.12306.cn")!=-1}catch(d){}h||($("#loginForm table tr:first td:last").append("<a href='https://dynamic.12306.cn/otsweb/' target='_blank' style='font-weight:bold;color:red;'>点击全屏订票<\/a>"),utility.getPref("login.fullscreenAlert")||(utility.setPref("login.fullscreenAlert",1),utility.notify("强烈建议你点击界面中的『点击全屏订票』来全屏购票，否则助手有些提示消息您将无法看到！")));$(".enter_right").empty().append("<div class='enter_enw'><div class='enter_rtitle titlebar' style='padding: 40px 0px 10px 0px; font-size: 20px;'>♥ 亲，祝买票顺利<\/div><div class='enter_rfont'><ul id='tipScript'><li class='fish_clock' id='countEle' style='font-weight:bold;'>请输入登录信息<\/li><li style='color:green;'><strong>操作信息<\/strong>：<span>休息中<\/span><\/li><li style='color:green;'><strong>最后操作时间<\/strong>：<span>--<\/span><\/li><li id=\"sysnoticeTitle\" style=\"margin-top: 10px;border-top: 1px dotted #ccc;color: blue;font-weight: bold;\"><\/li><li id=\"sysnoticeContent\" style=\"line-height:120%;\"><\/li><li id=\"updatesFound\" style=\"margin-bottom: 10px;border-bottom: 1px dotted #ccc;\">正在检测最新版...<\/li><li><a href='http://www.fishlee.net/soft/44/' style='color:#4D4DB6;' target='_blank'>助手主页<\/a> | <a href='http://bbs.fishlee.net/' target='_blank' style='color:#4D4DB6;'>助手论坛<\/a> | <a href='http://www.fishlee.net/soft/44/announcement.html' style='color:#4D4DB6;' target='_blank'>免责声明<\/a><\/li><li><a style='font-weight:bold;color:red;' href='http://www.fishlee.net/soft/44/donate.html' target='_blank'>捐助作者<\/a> | <a href='http://t.qq.com/ccfish/' style='color:#4D4DB6;' target='_blank'>腾讯微博<\/a> | <a href='http://weibo.com/imcfish/' style='color:#4D4DB6;' target='_blank'>新浪微博<\/a><\/li><\/ul><\/div><\/div>");n=[];n.push("<div class='outerbox' style='margin:20px 0;'><div class='box' style='margin:0;width:auto;'><div class='title'>12306订票助手 - 小提示<\/div><div style='padding:10px;'>");n.push("<table id='helperTipTable'><tr><td style='width:33%;font-weight:bold;background-color:#f5f5f5;'><strong>您还可以通过以下网址访问订票网站：<\/strong><\/td><td style='width:33%;font-weight:bold;background-color:#f5f5f5;'>助手运行常见问题<\/td><td style='font-weight:bold;background-color:#f5f5f5;'>版本信息<\/td><\/tr>");n.push("<tr><td><ul><li style='list-style:disc inside;'><a href='https://www.12306.cn/otsweb/' target='blank'>https://www.12306.cn/otsweb/<\/a><\/li>");n.push("<li style='list-style:disc inside;'><a href='https://dynamic.12306.cn/otsweb/' target='blank'>https://dynamic.12306.cn/otsweb/<\/a><\/li><li style='list-style:disc inside;'><a href='http://dynamic.12306.cn/otsweb/' target='blank'>http://dynamic.12306.cn/otsweb/<\/a><\/li>");n.push("<\/ul><\/td><td><ol>");$.each([["http://www.fishlee.net/soft/44/tour.html","订票助手使用指南","font-weight:bold;color:red;"],["http://www.fishlee.net/soft/44/12306faq.html","订票的常见问题&指南",""],["http://www.fishlee.net/soft/44/faq.html","助手运行的常见问题",]],function(t,i){n.push("<li style='list-style:disc inside;'><a style='"+i[2]+"' href='"+i[0]+"' target='blank'>"+(i[1]||i[0])+"<\/a><\/li>")});n.push("<\/ol><\/td><td><ul>");r=[];r.push("已许可于："+utility.regInfo.name);utility.regInfo.bindAcc&&(utility.regInfo.bindAcc[0]&&utility.regInfo.bindAcc[0]!="*"?r.push("许可12306帐户："+utility.regInfo.bindAcc):r.push("许可12306帐户：<em>无限<\/em>"));r.push(utility.regInfo.typeDesc);r.push("版本：<strong>"+window.helperVersion+"<\/strong>");$.each(r,function(t,i){n.push("<li style='list-style:disc inside;'>"+i+"<\/li>")});n.push("<li style='list-style:disc inside;'>【<a href='javascript:;' class='reSignHelper'>重新注册<\/a>】<\/li>");n.push("<\/ul><\/td><\/tr><\/table>");n.push("<\/div><\/div><\/div>");$("div.enter_help").before(n.join(""));c=$("#loginForm");y=c.find("tr");y.eq(1).find("td:last").html('<label><input type="checkbox" id="keepInfo" '+(utility.getPref("__un")&&!utility.getPref("__up")?"":"checked='checked'")+" />记住密码<\/label>");$("#loginForm td:last").html('<label><input type="checkbox" checked="checked" id="autoLogin" name="autoLogin" /> 自动登录<\/label>');$("#loginForm td:last").find("input, select").initAsOption();$("#keepInfo").change(function(){this.checked||localStorage.getItem("__up")!=null&&(localStorage.removeItem("__up"),alert("保存的密码已经被删除！"))}).attr("checked",!(utility.getPref("__un")&&!utility.getPref("__up")));c.submit(function(){utility.setPref("_sessionuser",$("#UserName").val())});var p=$("#tipScript li"),w=1,f=0,l=!1;a=utility.getPref("__un");a&&$("#UserName").val(a);$("#password").val(utility.getPref("__up")||"");$("#randCode").keyup(function(n){$("#autoLogin")[0].checked&&(n=n||event,(n.charCode==13||$("#randCode").val().length==4)&&k())});v=new Date;n=["<tr><td colspan='3' style='font-weight:bold;background-color:#f5f5f5;'>预售期提示<\/td><\/tr><tr><td colspan='3'>网上和电话订票提前20天，本日起售【<u>"];n.push(utility.formatDate(o.call(v,19)));n.push("<\/u>】日车票。代售点和车站提前18天，本日起售【<u>");n.push(utility.formatDate(o.call(v,17)));n.push("<\/u>】日车票。<br />【<a href='javascript:;' id='querySaleDate'>根据乘车日期推算起售日期<\/a>】【<a href='http://www.12306.cn/mormhweb/zxdt/tlxw_tdbtz56.html' target='_blank'>以相关公告、车站公告为准<\/a>】<\/p><\/td><\/tr>");$("#helperTipTable").prepend(n.join(""));$("#querySaleDate").click(function(){var n=prompt("请输入您要乘车的日期，如：2013-02-01");n&&(/(\d{4})[-/]0?(\d{1,2})[-/]0?(\d{1,2})/.exec(n)||alert("很抱歉未能识别日期"),n=new Date(parseInt(RegExp.$1),parseInt(RegExp.$2)-1,parseInt(RegExp.$3)),alert("您查询的乘车日期是："+utility.formatDate(n)+"\n\n互联网、电话起售日期是："+utility.formatDate(o.call(n,-19))+"\n车站、代售点起售日期是："+utility.formatDate(o.call(n,-17))+"\n\n以上结果仅供参考。"))}),function(){var u="login_ulist",n,t,r,i;$("#UserName").css({width:"204px","line-height":"28px",position:"absolute",top:"5px",left:"0","z-index":"101"}).parent().css({position:"absolute"}).end().after('<select id="ulist" style="width: 227px;position: absolute;left: 0px;top: 5px;line-height: 30px;height: 28px;z-index: 100;"><option value="">===========[请选择]===========<\/option><\/select><button class="lineButton" id="btnDeleteUser" type="button" style="position:absolute;top:5px;left:230px;width:40px;line-height:20px;">删除<\/button>');n=utility.parseJSON(utility.getPref(u)||"{}");t=$("#ulist");for(r in n)t.append("<option value='"+r+"'>"+r+"<\/option>");i=function(){utility.setPref(u,JSON.stringify(n))};$(document).bind("userlogin",function(t){
//!data["loginUser.user_name"] || !data["user.password"]
n[t.user["loginUser.user_name"]]=document.getElementById("keepInfo").checked?t.user["user.password"]:"";i()});$("#btnDeleteUser").click(function(){var r=$("#UserName").val();r&&n[r]&&confirm("确定要删除保存的用户【"+r+"】吗？")&&(t.find("option[value="+r+"]").remove(),delete n[r],i())});t.change(function(){var i=t.val();i&&($("#UserName").val(i).change(),$("#password").val(n[i]).change(),t.val(""),n[i]?document.getElementById("randCode").select():document.getElementById("password").select())});$("#keepInfo").change(function(){if(!this.checked){for(var t in n)n[t]="";i()}})}()}function initPayOrder(){$("div.error_text").length>0&&(utility.notify("页面出错，稍后自动刷新！"),setTimeout(function(){self.location.reload()},3e3));return;var n,t,i}function initAdvancedTicketQuery(){function t(t){var i=[],r,u;for(i.push("<tr trainCode='"+t.trainNo+"'><td>"+t.date+"<\/td><td>"+t.trainNo+"<\/td><td><div>"+t.fromName+"<\/div><div>"+t.fromTime+"<\/div><\/td><td><div>"+t.toName+"<\/div><div>"+t.toTime+"<\/div><\/td><td>"+t.elapseTime+"<\/td>"),r=0;r<11;r++)i.push("<td><\/td>");i.push("<td><a href='javascript:;' class='book'>预定<\/a><a href='javascript:;' class='delete'>删除<\/a><\/td>");i.push("<\/tr>");u=$(i.join(""));n.before(u);u.data("train",t)}function i(){var t=n.prevAll("tr").filter(":not(:last)"),i=$.map(t,function(n){return $(n).data("train")});utility.setPref("advQueryTrainList",utility.toJSON(i))}var n;return}function initQueryGuide(){var n;$(document).append('<div id="pageGuide"><\/div>');n=$("#pageGuide")}function checkUpdate(){if(location.pathname=="/otsweb/"||location.pathname=="/otsweb/main.jsp")if(console.log("[INFO] 订票助手开始检测更新"),utility.isChrome||utility.isSogou||utility.isMaxthon||utility.isFirefox){var n="";utility.isMaxthon?n="maxthon":utility.isSogou?n="sogou":utility.isLieBaoEdition?n="lbintel":utility.isChrome?n="chrome":utility.isFirefox&&(n="firefox");runAjax("http://www.fishlee.net/service/update/44/version"+(n?"_"+n:"")+".js","GET",null,"text",null,function(n){var t,i;eval(n);typeof version_announcement=="undefined"&&(window.version_announcement="");typeof version_announcement_title=="undefined"&&(window.version_announcement_title="");t={success:!0,v:version_12306_helper,updates:version_updater,announcement:version_announcement,announcementTitle:version_announcement_title,foundnew:!1};console.log("[INFO] 更新检查：当前助手版本="+version+"，新版本="+version_12306_helper);compareVersion(version,version_12306_helper)<0&&(t.foundnew=!0,confirm("订票助手已发布新版 【"+version_12306_helper+"】，为了您的正常使用，请及时更新!是否立刻更新？\n\n本次更新内容如下：\n"+version_updater.join("\n"))&&(self.location=utility.getUpdateUrl()));i=document.createElement("script");i.textContent="window.cn12306update="+buildObjectJavascriptCode(t);document.head.appendChild(i)},function(){console.log("[ERROR] 助手检测更新失败");var n=document.createElement("script");n.textContent="window.cn12306update="+buildObjectJavascriptCode({success:!1});document.head.appendChild(n)})}else unsafeInvoke(function(){$("body").append('<iframe id="checkVersion" width="0" height="0" style="visibility:hidden;" src="http://static.fishlee.net/content/scriptProxy.html?script=http://static.fishlee.net/content/images/apps/cn12306/checkVersion.js&spec=&v='+window.helperVersion+'"><\/iframe>')});else location.pathname=="/otsweb/loginAction.do"?unsafeInvoke(function(){var i=$("#sysnoticeTitle"),r=$("#sysnoticeContent"),n=$("#updatesFound"),t=utility.getTopWindow(),u=setInterval(function(){if(typeof t.cn12306update!="undefined"){var f=t.cn12306update;window.clearInterval(u);i.html(f.announcementTitle);r.html(f.announcement);f.success?f.foundnew?n.html("<a href='"+utility.getUpdateUrl()+"' style='color:blue;' target='_blank'>点此更新最新版助手(版本"+f.v+")！<\/a>").css({color:"blue","font-weight":"bold"}):n.html("您正在使用最新版订票助手["+f.v+"] :)").css({color:"gray"}):n.html("<a href='http://www.fishlee.net/soft/44/download.html' target='_blank'>检测更新时发生错误，点此查看官方主页下载<\/a>").css({color:"red","font-weight":"bold"})}},1e3)}):unsafeInvoke(function(){var n=utility.getTopWindow(),t=setInterval(function(){var i,r;typeof n.cn12306update!="undefined"&&(i=n.cn12306update,window.clearInterval(t),i.success&&i.foundnew&&(r=document.createElement("div"),r.innerHTML='<div style="position:fixed;z-index:1000;left:20px;top:20px;padding: 10px;background-color: #F2FFF5;border: 1px solid rgb(150, 201, 150);"><a href="'+utility.getUpdateUrl()+'" style="color: rgb(81, 119, 74);" target="_blank">点此更新最新版助手(版本'+i.v+")！<\/a><\/div>",document.body.appendChild(r)))},1e3)})}function compareVersion(n,t){for(var r=n.split("."),u=t.split("."),o=Math.min(r.length,u.length),f,e,i=0;i<o;i++){if(f=parseInt(r[i]),e=parseInt(u[i]),f<e)return-1;if(f>e)return 1}return r.length>u.length?1:r.length<u.length?-1:0}function runAjax(n,t,i,r,u,f,e){var c,l,h,a,y,o,v,s;if(t=="GET"&&i){h=[];for(s in i)h.push(s+"="+encodeURIComponent(i[s]));c=h.join("&");l=/(\?)(.*)+$/i.exec(n);l?l[2]||(n+="&"+c):n+="?"+c}if(u=u||{},typeof GM_xmlhttpRequest!="undefined"){if(t=="POST"&&i){h=[];for(s in i)h.push(s+"="+encodeURIComponent(i[s]));i=h.join("&")}a=function(n){for(var i=/([a-z0-9-_]+):\s*([^\r\n]+)/gi,t={};i.exec(n);)t[RegExp.$1]=RegExp.$2;return t};y={url:n,method:t,data:i,onload:function(n){var t=a(n.responseHeaders);f&&f.call({status:n.status,reponseText:n.reponseText,reponse:r=="json"?n.responseJSON:n.responseText,headers:t,getHeader:function(n){return t[n]}},r=="json"?n.responseJSON:n.responseText)},onerror:function(n){var t=a(n.responseHeaders);e&&e.call({status:n.status,reponseText:n.reponseText,reponse:r=="json"?n.responseJSON:n.responseText,headers:t,getHeader:function(n){return t[n]}},r=="json"?n.responseJSON:n.responseText)},headers:u.headers};GM_xmlhttpRequest(y)}else{if(o=new window.XMLHttpRequest,o.open(t,n,!0),u.mime&&o.overrideMimeType(u.mime),u.headers&&utility.isChrome)for(s in u.header)o.setRequestHeader("Fish-"+s,u.header[s]);if(o.onreadystatechange=function(){if(o.readyState==4)if(o.staus==0||o.status>=400)e&&e.call({status:o.status,reponseText:o.reponseText,reponse:o.response,getHeader:o.getResponseHeader,headers:o.getAllResponseHeaders()},o.response);else{var n=r=="json"?JSON.parse(o.responseText):o.responseText;f&&f.call({status:o.status,reponseText:o.reponseText,reponse:n,getHeader:o.getResponseHeader,headers:o.getAllResponseHeaders},n)}},t=="POST"){v=new FormData;for(s in i)v.append(s,i[s]);i=v}o.send(i)}}function checkDefaultOption(){window.localStorage["query.autoexpand"]||window.localStorage.setItem("query.autoexpand","1")}function mapTabIndex(n){for(var i,t=0;t<n.length;t++)i=document.getElementById(n[t]),i&&(i.tabIndex=t+1)}var version="5.1.8",updates=["* 微调运行逻辑","* 修正普通查票时不会自动记住查询参数的BUG","* 修正部分情况下的布局问题","* 当记住的查询日期早于今天时，默认忽略","* 优化不显示滚动条选项的效果","+ 启用新的检测升级机制","* 去除随机刷新间隔最低为5的限制（刷新间隔5秒已内置）"],faqUrl="http://www.fishlee.net/soft/44/faq.html",utility_emabed=!1,compVersion="5.91",isDebug=(compressFunc+"").indexOf("false")!=-1,utility={appid:"",configTab:null,icon:"http://www.12306.cn/mormhweb/images/favicon.ico",regInfo:null,disabledFeaturesCache:null,isFirefox:!1,isWebKit:!1,isChrome:!1,isLieBaoEdition:!1,isSogou:!1,isMaxthon:!1,parseJSON:function(n){if(JSON&&JSON.parse)return JSON.parse(n);alert("您的浏览器版本过低，请升级浏览器！")},toJSON:function(n){if(JSON&&JSON.parse)return JSON.stringify(n);alert("您的浏览器版本过低，请升级浏览器！")},disabledFeatures:function(){return utility.disabledFeaturesCache||(utility.disabledFeaturesCache=(utility.getPref("disabled")||"").split("|")),utility.disabledFeaturesCache},isfeatureDisabled:function(n){return $.inArray(n,utility.disabledFeatures())!=-1},disableFeature:function(n){n&&utility.disabledFeaturesCache.push(n);utility.setPref("disabled",utility.disabledFeaturesCache.join("|"))},clearFeatrueDisabled:function(){utility.setPref("disabled","");utility.disabledFeaturesCache=[]},getScriptVersion:function(){return/=([\d\.]+)$/i.exec($("script[src*=/otsweb/]:eq(0)").attr("src")+"")[1]},checkCompatible:function(){var n=utility.getScriptVersion(),t;if(n!=window.compVersion&&utility.getPref("dismissVersionWarning")!=n){utility.getPref("compWarning")!=n&&(utility.setPref("compWarning",n),alert("警告：检测到12306已改版，助手功能可能会被祸害。请在正式购票前做好测试……那啥无法购票时，请暂时手动或改用IE购票，并留意助手升级 :-("));$(".versionWarning").show();t=!1;try{t=self==parent}catch(i){t=!0}t||($("body").prepend("<div style='opacity:0.9;z-index:999; position:fixed; left:-280px; top:0px; width: 560px;margin-left:50%; color:#8A0023;border:1px solid #8A0023;line-height: 20px;background: -webkit-linear-gradient(#FFE4EA, #FFC3D1);background: -moz-linear-gradient(#FFE4EA, #FFC3D1);padding: 5px;'>亲，<strong>瞥见网站改版鸟<\/strong>！助手可能会被祸害……发现无法购票的时候，果断换到IE再奋斗~~<button id='dismissVersionWarning' class='fish_button'>不再提示<\/button><\/div>"),$("#dismissVersionWarning").click(function(){alert("助手将不会再显示此版本网站的不兼容提示咯，您老记好哈~~\n\n网站再改版后，助手会再告诉你嘀。");utility.setPref("dismissVersionWarning",n);$(this).parent().remove()}))}else $(".versionWarning").hide()},trim:function(n){return typeof $!="undefined"?$.trim(n):n.replace(/(^\s+|\s+$)/g,"")},getTopWindow:function(){try{return parent==self?self:parent.window.utility.getTopWindow()}catch(n){return self}},init:function(){$.extend({any:function(n,t){var i=!1;return $.each(n,function(n,r){return i=t.call(this,n,r),i?!1:void 0}),i},first:function(n,t){var i=null;return $.each(n,function(n,r){return i=t.call(this,n,r),i?!1:void 0}),i},prompt:function(n){return n=$.extend({buttons:[],title:"10306订票助手",ele:null,content:null,onCancel:function(){},closeOnClick:!0,to:null},n),function(n){var t,i,u,r,f;this.options=n;t=this;i=$("#fishPromptDlg");i.length||($("body").append('<div id="fishPromptDlg" class="fishDialog"><div class="fishDialogTitle"><\/div><div class="fishDialogContent"><\/div><div class="fishDialogControls"><button class="close_button fish_button">关闭<\/button><\/div><\/div>'),i=$("#fishPromptDlg"));u=i.find(".fishDialogControls");u.find(":not(.close_button)").remove();$.each(this.options.buttons,function(){var n=$('<button class="fish_button '+this.cssClass+'">'+this.text+"<\/button>"),i=this.handler;i&&n.click(function(){t.options.closeOnClick&&t.close();i.call(t,this)});u.prepend(n)});i.find(".fishDialogTitle").html(this.options.title);r=i.find(".fishDialogContent");this.options.content?(r.html(this.options.content),i.width(500)):(i.css("width","auto"),f=r.children(),$("body").append(f.hide()),r.width(this.options.ele.innerWidth()),r.append(this.options.ele),this.options.ele.show());this.dialog=i.fishDialog({to:t.options.to});this.close=function(){t.dialog.closeDialog();t.options.onClose&&t.options.onClose.call(t)}}(n)}});$.fn.extend({fishDialog:function(n){var t="fs_dlg_opt",i=this;return i.data(t)?i.data(t):function(n){var i=this,h,l;i.options=$.extend({maskOpacity:.5,bindControl:null,removeDialog:this.attr("autoCreate")=="1",onClose:null,animationMove:20,speed:"fast",fx:"linear",show:"fadeInDown",hide:"fadeOutUp",onShow:null,timeOut:0,to:null,mask:!0},n);var r,u,e,o,s,f,v=$("body"),a=document.body.scrollLeft+document.documentElement.clientWidth,c=document.body.scrollTop+document.documentElement.clientHeight;return i.calcLocation=function(){if(r="50%",u="50%",e=i.width(),o=i.height(),s=-e/2,f=-o/2-i.options.animationMove,i.options.to){var n=i.options.to.position();r=n.top;u=n.left;r+o>=c&&(r=c-o-1);u+e>=a&&(u=a-e-1);u+="px";r+="px";s=0;f=-i.options.animationMove}},i.calcLocation(),i.options.mask&&(h=document.getElementById("fishDialogMask"),h||($("body").append("<div id='fishDialogMask' class='fishDialogMask'><\/div>"),h=document.getElementById("fishDialogMask")),$(h).css({height:c+"px",opacity:0}).show().animate({opacity:i.options.maskOpacity},"fast","linear")),i.css({position:i.options.parent||i.options.to?"absolute":"fixed",left:u,top:r,"margin-left":s+"px","margin-top":f-i.options.animationMove+"px","z-index":"10000"}),i.changeLoadingIcon=function(n){return i.removeClass().addClass("loadingDialog loadicon_"+(n||"tip")),i},i.autoCloseDialog=function(n){return setTimeout(function(){i.closeDialog()},n||2500),i},i.setLoadingMessage=function(n){return i.find("div").html(n),i},i.closeDialog=function(){return $(".close_button",i).unbind("click",i.closeDialog),i.removeData(t),i.animate({marginTop:f+i.options.animationMove+"px",opacity:"hide"},i.options.speed,i.options.fx,function(){i.options.bindControl&&i.options.bindControl.enable();i.options.onClose&&i.options.onClose.call(i);i.options.removeDialog&&i.options.remove()}),$("#fishDialogMask").animate({opacity:"hide"},"fast","linear"),i},$(".close_button",i).click(i.closeDialog),i.options.timeOut>0&&(l=i.options.onShow,i.options.onShow=function(){setTimeout(function(){i.closeDialog()},i.options.timeOut);l!=null&&l.call(i)}),i.options.bindControl&&i.options.bindControl.disable(),i.animate({marginTop:f+"px",opacity:"show"},i.options.speed,i.options.fx,function(){i.options.onShow&&i.options.onShow.call(i)}),i.data(t,i),i.bind("sizeChanged",function(){i.calcLocation();i.animate({left:u,top:r,"margin-left":s+"px","margin-top":f-i.options.animationMove+"px"},i.options.speed,i.options.fx)}),this}.call(i,n)},initAsOption:function(n){return n=n||"",this.each(function(){var u=this.tagName,f=this.getAttribute("id"),e=this.getAttribute("type")||"",o=this.dataset.islist=="1",i=$(this),r=n+"_"+f,t=window.localStorage.getItem(r);u=="SELECT"&&o&&(t&&(t=t.indexOf("\t")!=-1?t.split("\t"):t.split("|"),$.each(t,function(){this.options[this.options.length]=new Option(this,this)})),i.bind("save",function(){window.localStorage["list_"+this.getAttribute("name")]=utility.getOptionArray(this).join("\t")}));i.attr("data-skey",r);t&&(e=="checkbox"?(this.checked=t=="1",i.change()):i.val(t).change())}).change(function(){var t=$(this),n=t.attr("data-skey");n&&(this.getAttribute("type")=="checkbox"?window.localStorage.setItem(n,this.checked?"1":"0"):window.localStorage.setItem(n,t.val()))}),this}});utility.isChrome&&$(document).ajaxSend(function(n,t,i){i.refer&&t.setRequestHeader("TRefer",i.refer)})},showLoginIE:function(){for(var f=document.cookie,r=f.split("; "),i="javascript:",u=[],n,t=0;t<r.length;t++)(n=r[t].split("="),n.length<2||n[0].indexOf("helper.")!=-1)||u.push('document.cookie="'+n[0]+"="+n[1]+'";');i+=u.join("");i+="self.location.reload();";$("#LoginIECode").val(i)},formatData:function(n){var t,i;if(!n)return"(null)";if(typeof n=="string")return n;t=[];for(i in n)t.push('"'+i+'":"'+(this[i]+"").replace(/(\r|\n|")/g,function(n){"\\"+n})+'"');return"{"+t.join(",")+"}"},notify:function(n,t,i){var r=utility.getTopWindow(),u;r==self?(u=new CustomEvent("notify",{detail:{msg:n,title:t||"",timeout:i||""}}),document.body.dispatchEvent(u)):r.utility.notify(n,t,i)},setPref:function(n,t){window.localStorage.setItem(n,t)},getPref:function(n){return window.localStorage.getItem(n)},unsafeCallback:function(n){typeof unsafeInvoke=="undefined"?n():unsafeInvoke(n)},getTimeInfo:function(){var n=new Date;return n.getHours()+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+":"+(n.getSeconds()<10?"0":"")+n.getSeconds()},getErrorMsg:function(n){var t=n.match(/var\s+message\s*=\s*"([^"]*)/);return t&&t[1]?t[1]:"&lt;未知信息&gt;"},delayInvoke:function(n,t,i){var u,r;n=n||"#countEle";u=typeof n=="string"?$(n):n;i<=0?(u.html("正在执行").removeClass("fish_clock").addClass("fish_running"),t()):(r=Math.floor(i/100)/10+"",r.indexOf(".")==-1&&(r+=".0"),u.html(r+" 秒后再来!...").removeClass("fish_running").addClass("fish_clock"),setTimeout(function(){utility.delayInvoke(n,t,i-500)},500))},addOption:function(n,t,i){n.options[n.options.length]=new Option(t,i)},getOptionArray:function(n){return $.map(n.options,function(n){return n.value})},inOptionList:function(n,t){for(var i=0;i<n.options.length;i++)if(n.options[i].value==t)return!0;return!1},getAudioUrl:function(){return window.localStorage.audioUrl||"http://static.fishlee.net/resources/audio/music2.ogg"},getFailAudioUrl:function(){return"http://static.fishlee.net/resources/audio/music3.ogg"},playFailAudio:function(){window.Audio&&new Audio(utility.getFailAudioUrl()).play()},resetAudioUrl:function(){window.localStorage.removeItem("audioUrl")},parseDate:function(n){return/(\d{4})[-/](\d{1,2})[-/](\d{1,2})/.exec(n),new Date(RegExp.$1,RegExp.$2-1,RegExp.$3)},getDate:function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())},formatDate:function(n){var t=n.getFullYear();return t+"-"+utility.formatDateShort(n)},formatDateShort:function(n){var t=n.getMonth()+1,n=n.getDate();return(t>9?t:"0"+t)+"-"+(n>9?n:"0"+n)},formatTime:function(n){function t(n){return n<10?"0"+n:n}return utility.formatDate(n)+" "+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())},addTimeSpan:function(n,t,i,r,u,f,e){return new Date(n.getFullYear()+t,n.getMonth()+i,n.getDate()+r,n.getHours()+u,n.getMinutes()+f,n.getSeconds()+e)},serializeForm:function(n){var r={},t=n.serializeArray(),i;for(i in t)typeof r[t[i].name]=="undefined"?r[t[i].name]=t[i].value:r[t[i].name]+=","+t[i].value;return r},getSecondInfo:function(n){var t="",i=parseInt(n/3600),r;return i>0&&(t=i+"小时",n=n%3600),r=parseInt(n/60),r>=1?(t=t+r+"分",n=n%60):i>=1&&n>0&&(t=t+"0分"),n>0&&(t=t+n+"秒"),t},post:function(n,t,i,r,u,f,e){var o=function(n){var t=utility.checkResponse(n);t<1?(alert("警告："+(t==0?"操作失败":"系统已强制退出登录")+"，可能是系统已升级。"+(f?"\n为了保证您的安全，功能【"+f+"】已被自动禁用，请重新登录。\n在助手升级后，功能将会被自动重新开启。\n\n请重新登录。":"")),utility.disableFeature(f),t==-1&&(self.location="/otsweb/loginAction.do?method=init")):u&&u.apply(this,arguments)};$.ajax({url:n,data:t,timeout:1e4,type:"POST",success:function(n,t,i){utility.checkResponse(i)<1?o(i):r&&r.apply(this,arguments)},error:o,dataType:i,refer:utility.getFullUrl(e)})},checkResponse:function(n){var t=n.responseText;return!t||t.indexOf("<title>登录<\/title>")!=-1?-1:t=="-1"?0:1},get:function(n,t,i,r,u,f,e){var o=function(n){var t=utility.checkResponse(n);t<1?(alert("警告："+(t==0?"操作失败":"系统已强制退出登录")+"，可能是系统已升级。"+(f?"\n为了保证您的安全，功能【"+f+"】已被自动禁用，请重新登录。\n在助手升级后，功能将会被自动重新开启。\n\n请重新登录。":"")),utility.disableFeature(f),t==-1&&(self.location="/otsweb/loginAction.do?method=init")):u&&u.apply(this,arguments)};$.ajax({url:n,data:t,timeout:1e4,type:"GET",success:function(n,t,i){utility.checkResponse(i)<1?o(i):r&&r.apply(this,arguments)},error:o,dataType:i,refer:utility.getFullUrl(e)})},fishTab:function(n,t){return function(n){var t=this;return n=$.extend({switchOnHover:!1,switchOnClick:!0},n),this.addClass("fishTab"),this.showTab=function(i){t.find(".current").removeClass("current");t.find("ul.tabNav li[tab="+i+"], div."+i).addClass("current");n.onShow&&n.onShow();t.trigger("sizeChanged")},t.find(".tabNav li").hover(function(){n.switchOnHover&&t.showTab($(this).attr("tab"))}).click(function(){n.switchOnClick&&t.showTab($(this).attr("tab"))}),this.showTab(t.find(".tabNav").attr("default")||t.find(".tabNav li:eq(0)").attr("tab")),this}.call(n,t)},getLoginRetryTime:function(){return parseInt(window.localStorage.getItem("login.retryLimit"))||2e3},showOptionDialog:function(n){n&&utility.configTab.showTab(n);$("#fishOption").fishDialog()},addCookie:function(n,t,i){var r=n+"="+t+"; path=/; domain=.12306.cn";i>0&&(r+="; expires="+new Date((new Date).getTime()+i*864e5).toGMTString());document.cookie=r},getCookie:function(n){for(var u=document.cookie,r=u.split("; "),i,t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]},setSnInfo:function(n,t){utility.setPref("helper.regUser",n);utility.setPref("helper.regSn",t);utility.addCookie("helper.regUser",n,999);utility.addCookie("helper.regSn",t,999)},verifySn:function(n,t,i){var i,u,e,r;if(t=t||utility.getPref("helper.regUser")||utility.getCookie("helper.regUser"),i=i||utility.getPref("helper.regSn")||utility.getCookie("helper.regSn"),!t&&i)return utility.verifySn2(n,i);if(!t||!i)return i={result:0,msg:"未注册",name:"基本用户",typeDesc:"基本版",type:"DEMO"},utility.isLieBaoEdition&&(i={result:0,msg:"未注册",name:"猎豹浏览器用户",typeDesc:"正式版",type:"NRML",partner:1}),i;if(utility.setSnInfo(t,i),u=i.split(","),!n&&(new Date-u[0])/6e4>5)return{result:-1,msg:"序列号注册已失效"};var o=[],s=u[0]+u[1],f=0;for(e=0;e<u[2].length;e+=4)o.push(String.fromCharCode(parseInt(u[2].substr(e,4),16)^s.charCodeAt(f))),f++,f>=s.length&&(f=0);return r=o.join(""),r={result:null,type:r.substring(0,4),name:r.substring(4)},r.result=r.name==t?0:-3,r.msg=r.result==0?"成功验证":"注册无效",r.typeDesc=r.type=="NRML"?"正式版":r.type=="GROP"?"内部版, <span style='color:blue;'>感谢您参与我们之中<\/span>!":"<span style='color:red;'>捐助版, 非常感谢您的支持<\/span>!",r},verifySn2:function(n,t){var o,s,f,h,r,u,i,t;t=utility.trim(t);try{for(o=parseInt(t.substr(0,2),16),s=t.substr(2,o),t=t.substring(2+o),f=[],i=0;i<t.length;i++)h=t.charCodeAt(i),h>=97?f.push(String.fromCharCode(h-49)):f.push(t.charAt(i));t=f.join("");var e=parseInt(t.substr(0,14),16),a=parseInt(t.substr(14,1),16),c=e.toString(16).toUpperCase()+a.toString().toUpperCase();for(t=t.substring(15),r=[],u=0,i=0;i<t.length;i+=4)r.push(String.fromCharCode(parseInt(t.substr(i,4),16)^c.charCodeAt(u))),u++,u>=c.length&&(u=0);r=r.join("").split("|");var v=r[0].substr(0,4),y=r[0].substring(4),l=r.slice(1,r.length);if(!l&&!n&&(new Date-e)/6e4>5)return{result:-1,msg:"注册码已失效， 请重新申请"};if(y!=s)return{result:-3,msg:"注册失败，用户名不匹配"};t={name:s,type:v,bindAcc:l,ticket:e,result:0,msg:"成功注册"};switch(t.type){case"NRML":t.typeDesc="正式版";break;case"GROP":t.typeDesc="内部版, <span style='color:blue;'>感谢您参与我们之中<\/span>!";break;case"DONT":t.typeDesc="<span style='color:red;'>捐助版, 非常感谢您的支持<\/span>!";break;case"PART":t.typeDesc="合作版，欢迎您的使用"}return t.regTime=new Date(e),t.regVersion=2,t}catch(p){return{result:-4,msg:"数据错误"}}},allPassengers:null,getAllPassengers:function(n,t){function r(){utility.get("/otsweb/order/confirmPassengerAction.do?method=getpassengerJson",null,"json",function(t){utility.allPassengers=t.passengerJson;n(utility.allPassengers)},function(){setTimeout(r,3e3)},"pasload","/otsweb/order/confirmPassengerAction.do?method=init")}var i,u;if(utility.allPassengers){n(utility.allPassengers);return}if(i=utility.getTopWindow(),i!=self)return i.utility.getAllPassengers(n,t);if(utility.isfeatureDisabled("pasload"))return[];utility.allPassengers=[];u=0;r()},getFullUrl:function(n){return typeof n=="undefined"||!n?"":location.protocol+"//"+location.host+n},regCache:{},getRegCache:function(n){return utility.regCache[n]||(utility.regCache[n]=new RegExp("^("+n+")$","i"))},preCompileReg:function(n){var t=$.map(n,function(n){return n.value});return new RegExp("^("+t.join("|")+")$","i")},enableLoginIE:function(){$("body").append('<button class="fish_button configLink" style="width:150px;position:fixed;right:14px;top:20px;height:35px;"tab="tabLoginIE">获取登录到IE的代码<\/button>')},analyzeForm:function(n){var t={},i=/<form.*?action="([^"]+)"/.exec(n),r;return t.action=i?RegExp.$1:"",t.fields={},r=n.match(/<input\s*(.|\r|\n)*?>/gi),$.each(r,function(){if(/name=['"]([^'"]+?)['"]/.exec(this)){var n=RegExp.$1;t.fields[RegExp.$1]=/value=['"]([^'"]+?)['"]/.exec(this)?RegExp.$1:""}}),i=/submit_form_confirm\('confirmPassenger','([a-z]+)'\)/.exec(n),i&&(t.tourFlag=RegExp.$1),t},selectionArea:function(n){var t=this,i;return this.options=$.extend({onAdd:function(){},onRemove:function(){},onClear:function(){},onRemoveConfirm:function(){return!0},syncToStorageKey:"",defaultList:null,preloadList:null},n),this.append('<div style="padding:5px; border:1px dashed gray; background-color:#fafafa; width:110px;">(还没有添加任何项)<\/div>'),this.datalist=[],this.add=function(n){if(!($.inArray(n,t.datalist)>-1)){var r=typeof n=="string"?n:n.text,i=$('<input type="button" class="lineButton" value="'+r+'" title="点击删除" />');t.append(i);i.click(t.removeByButton);t.datalist.push(n);t.syncToStorage();t.checkEmpty();t.options.onAdd.call(t,n,i)}},this.removeByButton=function(){var n=$(this),i=n.index()-1,r=t.datalist[i];t.options.onRemoveConfirm.call(t,r,n,i)&&(n.remove(),t.datalist.splice(i,1),t.syncToStorage(),t.checkEmpty(),t.options.onRemove.call(t,r,n))},this.emptyList=function(){t.datalist=[];t.find("input").remove();t.syncToStorage();t.checkEmpty();t.options.onClear.call(t)},this.isInList=function(n){return $.inArray($.inArray(n,t.datalist))>-1},this.isInRegList=function(n){for(var i=0;i<t.datalist.length;i++)if(utility.getRegCache(t.datalist[i]).test(n))return!0;return!1},this.syncToStorage=function(){t.options.syncToStorageKey&&window.localStorage.setItem(t.options.syncToStorageKey,t.datalist.join("\t"))},this.checkEmpty=function(){t.find("input").length?t.find("div").hide():t.find("div").show()},t.options.syncToStorageKey&&(i=t.options.preloadList,i||(i=window.localStorage.getItem(this.options.syncToStorageKey),i=i?i.split("\t"):this.options.defaultList),i&&$.each(i,function(){t.add(this+"")})),this},getUpdateUrl:function(){var n="http://www.fishlee.net/Service/Download/44/";return utility.isLieBaoEdition?n+"189/12306%E8%AE%A2%E7%A5%A8%E5%8A%A9%E6%89%8B(%E7%8C%8E%E8%B1%B9%E6%8A%A2%E7%A5%A8%E5%85%9A%E9%9B%86%E6%88%90%E7%89%88).crx":utility.isSogou?n+"68/12306_ticket_helper.sext":utility.isMaxthon?n+"62/mxaddon.mxaddon":utility.isFirefox?n+"47/12306_ticket_helper.user.js":n+"63/12306_ticket_helper.crx"},isAdvancedSupport:function(){return utility.isChrome},getTicketInfo:function(n){var i={},u=n.match(/([\dA-Za-z])\*{5}(\d{4})/gi),f,r,t;for(f in u)r=u[f][0],t=parseInt(/\*0*(\d+)/.exec(u[f])[1]),t<3e3?(i[r]=t,r=="7"?i.M=t:r=="8"&&(i.O=t)):i.empty=t-3e3;return i},isDemoUser:function(){return utility.regInfo==null||utility.regInfo.type=="DEMO"},associateSwitch:function(){return this.change(function(){if(utility.setPref(this.id,this.checked?"1":"0"),this.dataset&&this.dataset.target){var n=$("#"+this.dataset.target);n&&(this.checked&&n.show()||n.hide())}}).each(function(){this.checked=utility.getPref(this.id)=="1"}),this.change(),this}};(function(){if(typeof window.webkitNotifications=="undefined")typeof ActiveXObject!="undefined"?alert("很抱歉，未能识别您的浏览器，或您的浏览器尚不支持脚本运行，请使用Firefox或Chrome浏览器！\n如果您运行的是Maxthon3，请确认当前页面运行在高速模式而不是兼容模式下 :-)"):typeof GM_notification=="undefined"?(alert("很抱歉，本脚本需要最新的Scriptish扩展、不支持GreaseMonkey，请禁用您的GreaseMonkey扩展并安装Scriptish！"),window.open("https://addons.mozilla.org/zh-CN/firefox/addon/scriptish/")):(utility.isFirefox=!0,initialzeAndStartup());else{if(!window.localStorage){alert("警告! localStorage 为 null, 助手无法运行. 请查看浏览器是否已经禁用 localStorage!\nFirefox请设置 about:config 中的 dom.storage.enabled 为 true .");return}utility.isWebKit=!0;typeof window.mx!="undefined"&&(utility.isMaxthon=!0);typeof sogouExplorer!="undefined"&&(utility.isSogou=!0);typeof chrome!="undefined"&&(utility.isChrome=!0);utility.isChrome?chrome.extension.sendRequest({"function":"getRunTimeInfo"},function(n){var t=n.appid;if(utility.appid=t,utility.isLieBaoEdition=n.isLiebaoIntel,t!="bpbefagpafkfgoihbmcgeileodldkpnf"&&t!="idjgmabfihmhmojipdkcackbihbdceno"&&t!="iojocdfolilckogkigiahnjfmpjinobl"&&t!="gkbheeokbgmmnbjhhlphckobccejghjn"){alert("警告！您所使用的订票助手是山寨的，并非官方发布！请卸载并下载官方版！");chrome.tabs.create({url:"http://www.fishlee.net/soft/44/download.html"});return}n.isOtherInstanceExist||initialzeAndStartup()}):initialzeAndStartup()}})()