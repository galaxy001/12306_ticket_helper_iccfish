function getVersion(n){var t=new window.XMLHttpRequest;t.open("GET","manifest.json");t.onload=function(){var i=JSON.parse(t.responseText);n(i.version)};t.send(null)}window.appId=/chrome-extension\:\/\/([^\/]+)\//.exec(chrome.extension.getURL(""))[1];getVersion(function(n){if(window.localStorage.cv!=n){window.localStorage.cv=n;var t=window.webkitNotifications.createNotification("http://www.12306.cn/mormhweb/images/favicon.ico","订票助手已更新","您的订票助手已成功更新至 "+n+" :-)");window.setTimeout(function(){t.cancel()},3e3);t.show()}}),function(){function r(n){var e=/trainClass=([^&]+)&/g.exec(n)[1],u=e.replace(/%23/g,"#").split("#"),t,o,r,f,s,i,h;if(u[0]=="QB")return null;t=[0,0,0,0,0];for(o in u)r=u[o],r=="D"?t[0]=1:r=="Z"?t[1]=1:r=="T"?t[2]=1:r=="K"?t[3]=1:r=="QT"&&(t[4]=1);for(f=[],s=["D","Z","T","K","QT"],i=0;i<t.length;i++)t[i]||(t[i]=Math.random()>.5?1:0),t[i]&&f.push(s[i]);return h=f.join("#")+"#",n.replace(e,escape(h))}var n=!1,t=function(){if(!n){var t={urls:["*://*.12306.cn/*"],types:["main_frame","sub_frame","stylesheet","script","image","object","xmlhttprequest","other"]};window.chrome.webRequest.onBeforeSendHeaders.addListener(function(n){for(var e=n.url,r=null,u=-1,f=-1,i,t=0;t<n.requestHeaders.length;++t)i=n.requestHeaders[t],i.name==="User-Agent"?i.value="Mozilla/5.0 (MSIE 9.0; Windows NT 6.1; Trident/5.0;)":i.name=="TRefer"?(r=i.value,u=t):i.name=="Referer"&&(f=t);return r&&u!=-1&&f!=-1&&(n.requestHeaders[f].value=r,n.requestHeaders.splice(u,1)),{requestHeaders:n.requestHeaders}},t,["blocking","requestHeaders"]);window.chrome.webRequest.onBeforeRequest.addListener(function(n){return n.url.indexOf("querySingleAction.do?method=queryLeftTicket")!=-1?{redirectUrl:r(n.url)}:null},t,["blocking"])}},i;window.appId=="gkbheeokbgmmnbjhhlphckobccejghjn"?(i=["bpbefagpafkfgoihbmcgeileodldkpnf","idjgmabfihmhmojipdkcackbihbdceno","iojocdfolilckogkigiahnjfmpjinobl"],chrome.management.getAll(function(r){for(var f,u=0;u<r.length;u++)f=r[u],n=n||f.enabled&&$.inArray(f.id,i)!=-1;if(n){console.log("因为找到了订票助手，所以此扩展中的订票助手已经被禁用。");return}t()})):t();window.chrome.extension.onRequest.addListener(function(t,i,r){var u=t.function,f;if(u=="notify"&&(f=window.webkitNotifications.createNotification("http://www.12306.cn/mormhweb/images/favicon.ico",t.title||"订票助手",t.message),window.setTimeout(function(){f.cancel()},t.timeout||5e3),f.show()),u=="getAppId"){r({id:window.appId});return}if(u=="isOtherInstanceExist"){r({exist:n});return}u=="isLieBaoSpecification"&&r({yes:appId=="gkbheeokbgmmnbjhhlphckobccejghjn"});u=="getRunTimeInfo"&&r({appid:window.appId,isOtherInstanceExist:n,isLiebaoIntel:appId=="gkbheeokbgmmnbjhhlphckobccejghjn"})})}()